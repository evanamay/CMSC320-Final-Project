<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>86ad63d788af4d2c9fa89c3a01bcc614</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      word-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<div class="cell markdown">
<center>
    <h1>Alcohol and Gross Domestic Product</h1>
    <h5>CMSC320 Final Project</h5>
    Valentyn Bolotin, Jacob Barats, Evan May
</center>
<hr>
</div>
<div class="cell markdown">
<center>
    <h3>Introduction</h3>
</center>
<p>Since its creation, alcohol has been a staple in human society. Every country at some point in history has drunk alcohol and today most countries still do. The difference between then and now is the change in restrictions on alcohol. While few countries like Kuwait have <a href="https://www.latimes.com/world/middleeast/la-fg-kuwait-islamists-alcohol-20150105-story.html#:~:text=Kuwait%20and%20Saudi%20Arabia%20are,people%20convicted%20of%20drinking%20alcohol">absolute bans on alcohol</a>, many have regulations in place to limit the amount of alcohol consumption for their citizens. The exact reasoning for these restrictions changes depending on the country but the general thought process is that when individuals consume less alcohol, they are better, more productive citizens.</p>
<p>We want to challenge this reasoning by determining if a country's alcohol consumption impacts a country's gross domestic product (GDP). While a country's GDP is not a perfect reflection of the productivity of a country, there is enough correlation between the two that an analysis can be conducted.</p>
<hr>
</div>
<div class="cell markdown">
<center>
    <h3>Data collection/curation</h3>
</center>
<p>To determine if alcohol consumption impacts a country's GDP, we need to wrangle data for a country's alcohol consumption and GDP. The problem was that many of these datasets were incomplete or over a small time frame. Our solution was wrangling data from several sources and filling out as much missing information as possible. We have listed all the datasets that we use in this tutorial below.</p>
<ul>
<li>Our World in Data
<ul>
<li><a href = "https://ourworldindata.org/alcohol-consumption">Alochol Consumption per Capita</a></li>
<li><a href = "https://ourworldindata.org/grapher/gdp-world-regions-stacked-area?tab=table&time=earliest..1991&country=GRC~DEU~GHA~GTM~GNB~GIN~GMB~GAB~GNQ~GEO">Gross Domestic Product (GDP) based on 2011 International Dollar ($)</a></li>
<li><a href = "https://ourworldindata.org/grapher/alcohol-consumption-vs-gdp-per-capita">Alochol Consumption per Capita vs GDP per Capita based on Purchasing Power Partiry (PPP) </a> <br></li>
</ul></li>
<li>University of Groningen, Maddison Project Database 2018
<ul>
<li><a href = "https://www.rug.nl/ggdc/historicaldevelopment/maddison/releases/maddison-project-database-2018">GDP per capita based on 2011 US Dollar with and without multiple benchmarks, Total Population </a> <br></li>
</ul></li>
<li>The World Bank, International Comparison Program (ICP)
<ul>
<li><a href = "https://ourworldindata.org/alcohol-consumption">Purchasing Power Partiry (PPP)</a> <br></li>
</ul></li>
<li>World Health Organization
<ul>
<li><a href = "https://www.who.int/data/gho/data/indicators/indicator-details/GHO/alcohol-recorded-per-capita-(15-)-consumption-(in-litres-of-pure-alcohol)">Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)</a></li>
</ul></li>
</ul>
<hr>
</div>
<div class="cell markdown">
<center>
    <h3>Parsing and Data management</h3>
</center>
<p>To complete the tutorial the following imports are required: <br> Note that the warning import is just to avoid unnecessary output and it will still run without it.</p>
</div>
<div class="cell code" data-execution_count="72">
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">&#39;ignore&#39;</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pandas.core.arrays <span class="im">import</span> integer</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pandas.core.arrays.numeric <span class="im">import</span> T</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pylab <span class="im">as</span> plt</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mpl_toolkits <span class="im">import</span> mplot3d</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.spatial <span class="im">import</span> ConvexHull</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> interpolate</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.ndimage</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> preprocessing</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsRegressor</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> metrics</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> PolynomialFeatures</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.interpolate <span class="im">import</span> interp1d</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, r2_score</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> Normalizer</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.decomposition <span class="im">import</span> PCA</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> KFold</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span></code></pre></div>
</div>
<div class="cell markdown">
<h4>Finding the Best Range</h4>
<p>As stated previously, the data we acquired had large amounts of missing data. Many countries did not record data for various reasons meaning the datasets contain sections of time where there is little to no meaningful data. If we were to take all of the data and perform an analysis on it, it would be too skewed by the missing data to produce any meaningful results. We decided to determine the range of years that had the most data.</p>
<p>First, we added the dataset from the Maddison Project Database.</p>
</div>
<div class="cell code" data-execution_count="73">
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>raw_data <span class="op">=</span> pd.read_stata(<span class="st">&#39;Data/mpd2018.dta&#39;</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>raw_df <span class="op">=</span> pd.DataFrame(raw_data)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>raw_df <span class="op">=</span> raw_df.rename(columns<span class="op">=</span> {<span class="st">&quot;countrycode&quot;</span> : <span class="st">&quot;code&quot;</span>, <span class="st">&quot;pop&quot;</span>:<span class="st">&quot;population&quot;</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;rgdpnapc&quot;</span>:<span class="st">&quot;gdp_pc_2011&quot;</span>, <span class="st">&quot;cgdppc&quot;</span>:<span class="st">&quot;gdp_pc_2011_mb&quot;</span>})</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>raw_df <span class="op">=</span> raw_df.drop(columns<span class="op">=</span>[<span class="st">&#39;i_cig&#39;</span>, <span class="st">&#39;i_bm&#39;</span>])</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>combined_df <span class="op">=</span> raw_df</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>combined_df</span></code></pre></div>
<div class="output execute_result" data-execution_count="73">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code</th>
      <th>country</th>
      <th>year</th>
      <th>gdp_pc_2011_mb</th>
      <th>gdp_pc_2011</th>
      <th>population</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AFG</td>
      <td>Afghanistan</td>
      <td>1820.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>3280.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AFG</td>
      <td>Afghanistan</td>
      <td>1870.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>4207.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AFG</td>
      <td>Afghanistan</td>
      <td>1913.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5730.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AFG</td>
      <td>Afghanistan</td>
      <td>1950.0</td>
      <td>2392.0</td>
      <td>2392.0</td>
      <td>8150.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AFG</td>
      <td>Afghanistan</td>
      <td>1951.0</td>
      <td>2422.0</td>
      <td>2422.0</td>
      <td>8284.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>19868</th>
      <td>ZWE</td>
      <td>Zimbabwe</td>
      <td>2012.0</td>
      <td>1623.0</td>
      <td>1604.0</td>
      <td>12620.0</td>
    </tr>
    <tr>
      <th>19869</th>
      <td>ZWE</td>
      <td>Zimbabwe</td>
      <td>2013.0</td>
      <td>1801.0</td>
      <td>1604.0</td>
      <td>13183.0</td>
    </tr>
    <tr>
      <th>19870</th>
      <td>ZWE</td>
      <td>Zimbabwe</td>
      <td>2014.0</td>
      <td>1797.0</td>
      <td>1594.0</td>
      <td>13772.0</td>
    </tr>
    <tr>
      <th>19871</th>
      <td>ZWE</td>
      <td>Zimbabwe</td>
      <td>2015.0</td>
      <td>1759.0</td>
      <td>1560.0</td>
      <td>14230.0</td>
    </tr>
    <tr>
      <th>19872</th>
      <td>ZWE</td>
      <td>Zimbabwe</td>
      <td>2016.0</td>
      <td>1729.0</td>
      <td>1534.0</td>
      <td>14547.0</td>
    </tr>
  </tbody>
</table>
<p>19873 rows Ã— 6 columns</p>
</div>
</div>
</div>
<div class="cell markdown">
<p>There is a large number of missing entries in our dataset. We need to find the section of the dataset that has the least number of missing data to conduct our analysis. To do this, we need to find the ranges in the dataset with the highest change over time.</p>
</div>
<div class="cell code" data-execution_count="74">
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>codes_arr <span class="op">=</span> []</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> code <span class="kw">in</span> pd.unique(combined_df.code):</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="bu">isinstance</span>(code, <span class="bu">str</span>):</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    codes_arr.append(code)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>combined_df <span class="op">=</span> combined_df[combined_df.code.isin(codes_arr)]</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>years_arr <span class="op">=</span> np.sort(pd.unique(combined_df.year).reshape(<span class="op">-</span><span class="dv">1</span>))</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>years_num <span class="op">=</span> {}</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> years_arr:</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  num_entries <span class="op">=</span> <span class="bu">len</span>(combined_df[combined_df.year <span class="op">==</span> year].index)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  years_num[year] <span class="op">=</span> num_entries</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(years_arr)):</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  year <span class="op">=</span> years_arr[i]</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  prev_year <span class="op">=</span> year</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> i <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    prev_year <span class="op">=</span> years_arr[i<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  delta_t <span class="op">=</span> year <span class="op">-</span> prev_year</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  delta_v <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  delta_vt <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> delta_t <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    delta_v <span class="op">=</span> (years_num[year] <span class="op">-</span> years_num[prev_year][<span class="dv">0</span>])</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    delta_vt <span class="op">=</span> <span class="bu">float</span>(delta_v)<span class="op">/</span><span class="bu">float</span>(delta_t)</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  years_num[year] <span class="op">=</span> [years_num[year], years_num[year] <span class="op">-</span> <span class="bu">len</span>(codes_arr), delta_t,</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>                     delta_v, delta_vt]</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>high_delta_indicies <span class="op">=</span> []</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>start_year <span class="op">=</span> years_arr[<span class="dv">0</span>]</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>high_delta_indicies.append([<span class="dv">0</span>, np.<span class="bu">abs</span>(years_num[start_year][<span class="dv">4</span>]), <span class="dv">0</span>, <span class="dv">0</span>, </span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>          <span class="fl">1.0</span> <span class="op">+</span> <span class="bu">float</span>(years_num[start_year][<span class="dv">1</span>])<span class="op">/</span><span class="bu">float</span>(<span class="bu">len</span>(codes_arr)),</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>          <span class="dv">1</span>])</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>hd_index <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(years_arr)):</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>  year <span class="op">=</span> years_arr[i]</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>  curr_dvt <span class="op">=</span> np.<span class="bu">abs</span>(years_num[year][<span class="dv">4</span>])</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>  curr_dt <span class="op">=</span> years_num[year][<span class="dv">2</span>]</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>  curr_dv <span class="op">=</span> years_num[year][<span class="dv">3</span>]</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(curr_dvt <span class="op">&gt;</span> <span class="fl">0.2</span> <span class="op">*</span> <span class="bu">float</span>(years_num[year][<span class="dv">0</span>])):</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>    hd_index <span class="op">=</span> hd_index <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>    high_delta_indicies.append([i, curr_dvt, <span class="dv">0</span>, curr_dt,</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>      <span class="fl">1.0</span> <span class="op">+</span> <span class="bu">float</span>(years_num[year][<span class="dv">1</span>])<span class="op">/</span><span class="bu">float</span>(<span class="bu">len</span>(codes_arr)), <span class="dv">1</span>])</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>:</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>    tmp <span class="op">=</span> high_delta_indicies[hd_index]</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>    tmp[<span class="dv">2</span>] <span class="op">=</span> tmp[<span class="dv">2</span>] <span class="op">+</span> curr_dv</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>    tmp[<span class="dv">3</span>] <span class="op">=</span> tmp[<span class="dv">3</span>] <span class="op">+</span> curr_dt</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>    tmp[<span class="dv">4</span>] <span class="op">=</span> tmp[<span class="dv">4</span>] <span class="op">+</span> <span class="fl">1.0</span> <span class="op">+</span> <span class="bu">float</span>(years_num[year][<span class="dv">1</span>])<span class="op">/</span><span class="bu">float</span>(<span class="bu">len</span>(codes_arr))</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>    tmp[<span class="dv">5</span>] <span class="op">=</span> tmp[<span class="dv">5</span>] <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>    high_delta_indicies[hd_index] <span class="op">=</span> tmp</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>tmp <span class="op">=</span> []</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> elt <span class="kw">in</span> high_delta_indicies:</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> elt[<span class="dv">5</span>] <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>    tmp.append(elt)</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>high_delta_indicies <span class="op">=</span> tmp</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a><span class="co">#our output</span></span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> elt <span class="kw">in</span> high_delta_indicies[<span class="bu">len</span>(high_delta_indicies)<span class="op">-</span><span class="dv">3</span>:]:</span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>  to_print <span class="op">=</span> <span class="st">&quot;Index: </span><span class="sc">{}</span><span class="st">, year: </span><span class="sc">{}</span><span class="st">, absDvt: </span><span class="sc">{}</span><span class="st">, dv_ser: </span><span class="sc">{}</span><span class="st">, dt: </span><span class="sc">{}</span><span class="st">, adj_percent: </span><span class="sc">{}</span><span class="st">&quot;</span></span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>  to_print <span class="op">=</span> to_print.<span class="bu">format</span>(elt[<span class="dv">0</span>], years_arr[elt[<span class="dv">0</span>]], elt[<span class="dv">1</span>], elt[<span class="dv">2</span>], elt[<span class="dv">3</span>],</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>                             elt[<span class="dv">4</span>]<span class="op">/</span>elt[<span class="dv">3</span>])</span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(to_print)                         </span></code></pre></div>
<div class="output stream stdout">
<pre><code>Index: 624, year: 1900.0, absDvt: 26.0, dv_ser: -9, dt: 13.0, adj_percent: 0.345471096950387
Index: 638, year: 1914.0, absDvt: 29.0, dv_ser: 8, dt: 36.0, adj_percent: 0.37689020381328076
Index: 674, year: 1950.0, absDvt: 103.0, dv_ser: 0, dt: 67.0, adj_percent: 1.0
</code></pre>
</div>
</div>
<div class="cell markdown">
<ul>
<li>Index : Index in the array of all unique years</li>
<li>Year : Year for that data</li>
<li>absDvt : Absolute value of change over time in number of entries</li>
<li>dv_ser : Sum of all changes in values after the index change</li>
<li>dt : Delta time</li>
<li>adj_percent : Ratio of numbers in this vs the entire set</li>
</ul>
</div>
<div class="cell markdown">
<p>Based on the analysis done we can now score each of the ranges and find the most suitable range to conduct our analysis on.</p>
<p>Using the information collected, we now can calculate the scores for each of the year ranges.</p>
</div>
<div class="cell code" data-execution_count="75">
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>hd_scores <span class="op">=</span> []</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> elt <span class="kw">in</span> high_delta_indicies:</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  score <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">## % covered</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  score <span class="op">+=</span> elt[<span class="dv">4</span>]<span class="op">/</span>elt[<span class="dv">3</span>]</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">## ~time step</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  time_step <span class="op">=</span> elt[<span class="dv">3</span>]<span class="op">/</span>elt[<span class="dv">5</span>]</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  time_step_score <span class="op">=</span> np.exp(<span class="op">-</span>(time_step <span class="op">-</span> <span class="dv">1</span>))</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  score <span class="op">+=</span> time_step_score</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">## total entries</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  score <span class="op">+=</span> elt[<span class="dv">5</span>]<span class="op">/</span><span class="bu">len</span>(years_arr)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">## delta trend</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  dt_score <span class="op">=</span> <span class="bu">float</span>(elt[<span class="dv">2</span>])<span class="op">/</span><span class="bu">float</span>(<span class="bu">len</span>(codes_arr))</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  dt_score <span class="op">=</span> dt_score <span class="op">*</span> elt[<span class="dv">4</span>]<span class="op">/</span>elt[<span class="dv">3</span>]</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  dt_score <span class="op">=</span> dt_score<span class="op">/</span><span class="fl">2.0</span> <span class="op">+</span> <span class="fl">0.5</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  score <span class="op">+=</span> dt_score</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  hd_scores.append(score)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>max_index <span class="op">=</span> np.argmax(hd_scores)</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Best index: </span><span class="sc">{}</span><span class="st">, score: </span><span class="sc">{}</span><span class="st">, start_year: </span><span class="sc">{}</span><span class="st">, end_year: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>  max_index, hd_scores[max_index], years_arr[high_delta_indicies[max_index][<span class="dv">0</span>]],</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>  years_arr[high_delta_indicies[max_index][<span class="dv">0</span>]] <span class="op">+</span> high_delta_indicies[max_index][<span class="dv">3</span>]</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span> years_num[years_arr[high_delta_indicies[max_index][<span class="dv">0</span>]]][<span class="dv">2</span>]</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Best index: 27, score: 2.5904183535762484, start_year: 1950.0, end_year: 2016.0
</code></pre>
</div>
</div>
<div class="cell markdown">
<p>For our tutorial, we will use data from 1950 to 2016. This will make later analysis easier as there is a smaller likelihood of missing data. We can now remove the unnecessary rows from our data frame, which is around 8000 rows.</p>
</div>
<div class="cell code" data-execution_count="76">
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>start_year <span class="op">=</span> years_arr[high_delta_indicies[max_index][<span class="dv">0</span>]]</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>end_year <span class="op">=</span> start_year <span class="op">+</span> high_delta_indicies[max_index][<span class="dv">3</span>]</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>combined_df <span class="op">=</span> combined_df[combined_df.year <span class="op">&gt;=</span> start_year]</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>combined_df <span class="op">=</span> combined_df[combined_df.year <span class="op">&lt;=</span> end_year]</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>combined_df.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="76">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code</th>
      <th>country</th>
      <th>year</th>
      <th>gdp_pc_2011_mb</th>
      <th>gdp_pc_2011</th>
      <th>population</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3</th>
      <td>AFG</td>
      <td>Afghanistan</td>
      <td>1950.0</td>
      <td>2392.0</td>
      <td>2392.0</td>
      <td>8150.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AFG</td>
      <td>Afghanistan</td>
      <td>1951.0</td>
      <td>2422.0</td>
      <td>2422.0</td>
      <td>8284.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>AFG</td>
      <td>Afghanistan</td>
      <td>1952.0</td>
      <td>2462.0</td>
      <td>2462.0</td>
      <td>8425.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>AFG</td>
      <td>Afghanistan</td>
      <td>1953.0</td>
      <td>2568.0</td>
      <td>2568.0</td>
      <td>8573.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>AFG</td>
      <td>Afghanistan</td>
      <td>1954.0</td>
      <td>2576.0</td>
      <td>2576.0</td>
      <td>8728.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell markdown">
<h4>Finding the missing values</h4>
<p>While the range of years we have found has the least amount of missing entries, there is still a relatively small amount in our data. In this tutorial, we want to make sure that we have as much GDP data as possible. To fill in this data we will extract more data from the Our World in Data dataset.</p>
</div>
<div class="cell code" data-execution_count="77">
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>cpc_df <span class="op">=</span> pd.read_csv(<span class="st">&#39;Data/alcohol-consumption-vs-gdp-per-capita.csv&#39;</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>cpc_df <span class="op">=</span> pd.DataFrame(cpc_df)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>cpc_df <span class="op">=</span> cpc_df.drop(labels <span class="op">=</span> <span class="st">&quot;Continent&quot;</span>, axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>cpc_df <span class="op">=</span> cpc_df.rename(columns<span class="op">=</span> {<span class="st">&quot;Total alcohol consumption per capita (liters of pure alcohol, projected estimates, 15+ years of age)&quot;</span> : <span class="st">&quot;consumption_for_person&quot;</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;GDP per capita, PPP (constant 2017 international $)&quot;</span> : <span class="st">&quot;gdp_pc_2017&quot;</span>, <span class="st">&quot;Population (historical estimates)&quot;</span>: <span class="st">&quot;population_cpc&quot;</span>,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;Entity&quot;</span> : <span class="st">&quot;country&quot;</span>, <span class="st">&quot;Code&quot;</span>:<span class="st">&quot;code&quot;</span>, <span class="st">&quot;Year&quot;</span>:<span class="st">&quot;year&quot;</span>})</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>cpc_df <span class="op">=</span> cpc_df[cpc_df.code.isin(codes_arr)]</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>cpc_df[<span class="st">&quot;total_liters_consumed&quot;</span>] <span class="op">=</span> cpc_df.consumption_for_person <span class="op">*</span> cpc_df.population_cpc</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>cpc_df <span class="op">=</span> cpc_df[cpc_df.year <span class="op">&gt;</span> start_year]</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>future_cpc_df <span class="op">=</span> cpc_df[cpc_df.year <span class="op">&gt;</span> end_year]</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>cpc_df <span class="op">=</span> cpc_df[cpc_df.year <span class="op">&lt;=</span> end_year]</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>cpc_df.gdp_pc_2017 <span class="op">=</span> cpc_df.gdp_pc_2017</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>cpc_df.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="77">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>country</th>
      <th>code</th>
      <th>year</th>
      <th>consumption_for_person</th>
      <th>gdp_pc_2017</th>
      <th>population_cpc</th>
      <th>total_liters_consumed</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>Afghanistan</td>
      <td>AFG</td>
      <td>2010</td>
      <td>0.21</td>
      <td>1957.029070</td>
      <td>29185511.0</td>
      <td>6128957.31</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Afghanistan</td>
      <td>AFG</td>
      <td>2015</td>
      <td>0.21</td>
      <td>2068.265904</td>
      <td>34413603.0</td>
      <td>7226856.63</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Afghanistan</td>
      <td>AFG</td>
      <td>2002</td>
      <td>NaN</td>
      <td>1189.784668</td>
      <td>22600774.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Afghanistan</td>
      <td>AFG</td>
      <td>2003</td>
      <td>NaN</td>
      <td>1235.810063</td>
      <td>23680871.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Afghanistan</td>
      <td>AFG</td>
      <td>2004</td>
      <td>NaN</td>
      <td>1200.278013</td>
      <td>24726689.0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell markdown">
<p>We can search for missing entries in the main data frame and attempt to fill it with the data in the new data frame. The dataset from Our World in Data has data on total alcohol consumption per capita so we can add that to our main data frame. Note that all missing entries from this point forward will be represented as -1.</p>
</div>
<div class="cell code" data-execution_count="78">
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>hit_years_arr <span class="op">=</span> np.sort(pd.unique(combined_df.year).reshape(<span class="op">-</span><span class="dv">1</span>))</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>temp_comb <span class="op">=</span> combined_df</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>cpc_merge <span class="op">=</span> cpc_df.drop(labels<span class="op">=</span>[<span class="st">&quot;gdp_pc_2017&quot;</span>,<span class="st">&quot;consumption_for_person&quot;</span>, <span class="st">&quot;population_cpc&quot;</span>, <span class="st">&quot;total_liters_consumed&quot;</span>],</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>                             axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> code <span class="kw">in</span> codes_arr:</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  cpc_code <span class="op">=</span> cpc_merge[cpc_merge.code <span class="op">==</span> code]</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  combined_code <span class="op">=</span> combined_df[combined_df.code <span class="op">==</span> code]</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  missing_years <span class="op">=</span> np.array(hit_years_arr)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  sub_years <span class="op">=</span> np.array(combined_code.year.to_numpy())</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  missing_years <span class="op">=</span> np.setdiff1d(missing_years, sub_years)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="bu">len</span>(missing_years <span class="op">&gt;</span> <span class="dv">0</span>):</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    cpc_fill <span class="op">=</span> cpc_code[cpc_code.year.isin(missing_years)]</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    cpc_fill.index <span class="op">+=</span> <span class="bu">len</span>(temp_comb.index)</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    temp_comb <span class="op">=</span> pd.concat([temp_comb,cpc_fill])</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>cpc_merge <span class="op">=</span> cpc_df.drop(labels <span class="op">=</span> [<span class="st">&quot;country&quot;</span>], axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>temp_comb <span class="op">=</span> pd.merge(how <span class="op">=</span> <span class="st">&quot;left&quot;</span>, left <span class="op">=</span> temp_comb, right <span class="op">=</span> cpc_merge, on<span class="op">=</span>[<span class="st">&quot;code&quot;</span>,<span class="st">&quot;year&quot;</span>])</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>temp_comb <span class="op">=</span> temp_comb.fillna(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>combined_df <span class="op">=</span> temp_comb</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>combined_df.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="78">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code</th>
      <th>country</th>
      <th>year</th>
      <th>gdp_pc_2011_mb</th>
      <th>gdp_pc_2011</th>
      <th>population</th>
      <th>consumption_for_person</th>
      <th>gdp_pc_2017</th>
      <th>population_cpc</th>
      <th>total_liters_consumed</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AFG</td>
      <td>Afghanistan</td>
      <td>1950.0</td>
      <td>2392.0</td>
      <td>2392.0</td>
      <td>8150.0</td>
      <td>-1.0</td>
      <td>-1.0</td>
      <td>-1.0</td>
      <td>-1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AFG</td>
      <td>Afghanistan</td>
      <td>1951.0</td>
      <td>2422.0</td>
      <td>2422.0</td>
      <td>8284.0</td>
      <td>-1.0</td>
      <td>-1.0</td>
      <td>7840151.0</td>
      <td>-1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AFG</td>
      <td>Afghanistan</td>
      <td>1952.0</td>
      <td>2462.0</td>
      <td>2462.0</td>
      <td>8425.0</td>
      <td>-1.0</td>
      <td>-1.0</td>
      <td>7935996.0</td>
      <td>-1.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AFG</td>
      <td>Afghanistan</td>
      <td>1953.0</td>
      <td>2568.0</td>
      <td>2568.0</td>
      <td>8573.0</td>
      <td>-1.0</td>
      <td>-1.0</td>
      <td>8039684.0</td>
      <td>-1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AFG</td>
      <td>Afghanistan</td>
      <td>1954.0</td>
      <td>2576.0</td>
      <td>2576.0</td>
      <td>8728.0</td>
      <td>-1.0</td>
      <td>-1.0</td>
      <td>8151316.0</td>
      <td>-1.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell markdown">
<p>We only want data that has a low amount of missing entries. Data that is missing all of its population data isn't helpful so we remove them.</p>
</div>
<div class="cell code" data-execution_count="79">
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>missing_codes <span class="op">=</span> {}</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> code <span class="kw">in</span> codes_arr:</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  pop <span class="op">=</span> combined_df[combined_df.code <span class="op">==</span> code]</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  pop <span class="op">=</span> pop[((pop.population <span class="op">&lt;</span> <span class="dv">0</span>) <span class="op">|</span> (pop.population_cpc <span class="op">&lt;</span> <span class="dv">0</span>))]</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  pop_arr <span class="op">=</span> []</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> i, row <span class="kw">in</span> pop.iterrows():</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    pop_arr.append(row.year)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  missing_codes[code] <span class="op">=</span> pop_arr</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> code_comp (a):</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="op">-</span><span class="bu">len</span>(missing_codes[a])</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>sorted_codes <span class="op">=</span> <span class="bu">sorted</span>(codes_arr, key<span class="op">=</span>code_comp)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>rem_codes <span class="op">=</span> []</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> code <span class="kw">in</span> sorted_codes:</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="bu">len</span>(missing_codes[code]) <span class="op">==</span> end_year <span class="op">-</span> start_year:</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    rem_codes.append(code)</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>combined_df <span class="op">=</span> combined_df[<span class="op">~</span>combined_df.code.isin(rem_codes)]</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>hit_codes <span class="op">=</span> pd.unique(combined_df.code).reshape(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>combined_df.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="79">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code</th>
      <th>country</th>
      <th>year</th>
      <th>gdp_pc_2011_mb</th>
      <th>gdp_pc_2011</th>
      <th>population</th>
      <th>consumption_for_person</th>
      <th>gdp_pc_2017</th>
      <th>population_cpc</th>
      <th>total_liters_consumed</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AFG</td>
      <td>Afghanistan</td>
      <td>1950.0</td>
      <td>2392.0</td>
      <td>2392.0</td>
      <td>8150.0</td>
      <td>-1.0</td>
      <td>-1.0</td>
      <td>-1.0</td>
      <td>-1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AFG</td>
      <td>Afghanistan</td>
      <td>1951.0</td>
      <td>2422.0</td>
      <td>2422.0</td>
      <td>8284.0</td>
      <td>-1.0</td>
      <td>-1.0</td>
      <td>7840151.0</td>
      <td>-1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AFG</td>
      <td>Afghanistan</td>
      <td>1952.0</td>
      <td>2462.0</td>
      <td>2462.0</td>
      <td>8425.0</td>
      <td>-1.0</td>
      <td>-1.0</td>
      <td>7935996.0</td>
      <td>-1.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AFG</td>
      <td>Afghanistan</td>
      <td>1953.0</td>
      <td>2568.0</td>
      <td>2568.0</td>
      <td>8573.0</td>
      <td>-1.0</td>
      <td>-1.0</td>
      <td>8039684.0</td>
      <td>-1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AFG</td>
      <td>Afghanistan</td>
      <td>1954.0</td>
      <td>2576.0</td>
      <td>2576.0</td>
      <td>8728.0</td>
      <td>-1.0</td>
      <td>-1.0</td>
      <td>8151316.0</td>
      <td>-1.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell markdown">
<h4>Additional tidying</h4>
<p>We want to make sure that all of the data is in the same units. We change our population's scale to be one to one and make both our GDP columns be in terms of GDP per capita. This avoids problems of unit conversion in analysis later.</p>
</div>
<div class="cell code" data-execution_count="80">
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>st_df <span class="op">=</span> combined_df</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>st_df[<span class="st">&quot;population&quot;</span>] <span class="op">=</span> st_df[<span class="st">&quot;population&quot;</span>] <span class="op">*</span> <span class="dv">1000</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>st_df.population[st_df.population <span class="op">&lt;</span> <span class="dv">0</span>] <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>st_df[<span class="st">&quot;gdp_2011&quot;</span>] <span class="op">=</span> st_df[<span class="st">&quot;gdp_pc_2011&quot;</span>] <span class="op">*</span> st_df[<span class="st">&quot;population&quot;</span>]</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>st_df.gdp_2011[st_df.gdp_2011 <span class="op">&lt;</span> <span class="dv">0</span>] <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>st_df[<span class="st">&quot;gdp_2011_mb&quot;</span>] <span class="op">=</span> st_df[<span class="st">&quot;gdp_pc_2011_mb&quot;</span>] <span class="op">*</span> st_df[<span class="st">&quot;population&quot;</span>]</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>st_df.gdp_2011_mb[st_df.gdp_2011_mb <span class="op">&lt;</span> <span class="dv">0</span>] <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>st_df[<span class="st">&quot;gdp_2017&quot;</span>] <span class="op">=</span> st_df[<span class="st">&quot;gdp_pc_2017&quot;</span>] <span class="op">*</span> st_df[<span class="st">&quot;population_cpc&quot;</span>]</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>st_df.gdp_2017[st_df.gdp_2017 <span class="op">&lt;</span> <span class="dv">0</span>] <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>st_df[<span class="st">&quot;population&quot;</span>] <span class="op">=</span> st_df[<span class="st">&quot;population&quot;</span>].astype(<span class="bu">int</span>)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>st_df[<span class="st">&quot;population_cpc&quot;</span>] <span class="op">=</span> st_df[<span class="st">&quot;population_cpc&quot;</span>].astype(<span class="bu">int</span>)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>st_df[<span class="st">&quot;year&quot;</span>] <span class="op">=</span> st_df[<span class="st">&quot;year&quot;</span>].astype(<span class="bu">int</span>)</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>st_df.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="80">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code</th>
      <th>country</th>
      <th>year</th>
      <th>gdp_pc_2011_mb</th>
      <th>gdp_pc_2011</th>
      <th>population</th>
      <th>consumption_for_person</th>
      <th>gdp_pc_2017</th>
      <th>population_cpc</th>
      <th>total_liters_consumed</th>
      <th>gdp_2011</th>
      <th>gdp_2011_mb</th>
      <th>gdp_2017</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AFG</td>
      <td>Afghanistan</td>
      <td>1950</td>
      <td>2392.0</td>
      <td>2392.0</td>
      <td>8150000</td>
      <td>-1.0</td>
      <td>-1.0</td>
      <td>-1</td>
      <td>-1.0</td>
      <td>1.949480e+10</td>
      <td>1.949480e+10</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AFG</td>
      <td>Afghanistan</td>
      <td>1951</td>
      <td>2422.0</td>
      <td>2422.0</td>
      <td>8284000</td>
      <td>-1.0</td>
      <td>-1.0</td>
      <td>7840151</td>
      <td>-1.0</td>
      <td>2.006385e+10</td>
      <td>2.006385e+10</td>
      <td>-1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AFG</td>
      <td>Afghanistan</td>
      <td>1952</td>
      <td>2462.0</td>
      <td>2462.0</td>
      <td>8425000</td>
      <td>-1.0</td>
      <td>-1.0</td>
      <td>7935996</td>
      <td>-1.0</td>
      <td>2.074235e+10</td>
      <td>2.074235e+10</td>
      <td>-1.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AFG</td>
      <td>Afghanistan</td>
      <td>1953</td>
      <td>2568.0</td>
      <td>2568.0</td>
      <td>8573000</td>
      <td>-1.0</td>
      <td>-1.0</td>
      <td>8039684</td>
      <td>-1.0</td>
      <td>2.201546e+10</td>
      <td>2.201546e+10</td>
      <td>-1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AFG</td>
      <td>Afghanistan</td>
      <td>1954</td>
      <td>2576.0</td>
      <td>2576.0</td>
      <td>8728000</td>
      <td>-1.0</td>
      <td>-1.0</td>
      <td>8151316</td>
      <td>-1.0</td>
      <td>2.248333e+10</td>
      <td>2.248333e+10</td>
      <td>-1.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell markdown">
<p>The 2017 GDP that was added to our dataset is in terms of the constant 2017 international dollar which is different than the 2011 GDP and the 2011 MB GDP. This causes issues when they are compared to one another in an analytical setting. Conversion factors are calculated for 2011 and 2016 are calculated for 2011, 2011 with multiple benchmarks, and 2017.</p>
</div>
<div class="cell code" data-execution_count="81">
<div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>y1_df <span class="op">=</span> combined_df[combined_df.year <span class="op">==</span> <span class="dv">2011</span>]</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>y2_df <span class="op">=</span> combined_df[combined_df.year <span class="op">==</span> <span class="dv">2016</span>]</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>y1_vals <span class="op">=</span> {<span class="st">&quot;gdp_2011&quot;</span>:<span class="dv">0</span>, <span class="st">&quot;gdp_2011_mb&quot;</span>:<span class="dv">0</span>, <span class="st">&quot;gdp_2017&quot;</span>:<span class="dv">0</span>}</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>y2_vals <span class="op">=</span> {<span class="st">&quot;gdp_2011&quot;</span>:<span class="dv">0</span>, <span class="st">&quot;gdp_2011_mb&quot;</span>:<span class="dv">0</span>, <span class="st">&quot;gdp_2017&quot;</span>:<span class="dv">0</span>}</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> code <span class="kw">in</span> hit_codes:</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  c_df <span class="op">=</span> y1_df[combined_df.code <span class="op">==</span> code]</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> v <span class="kw">in</span> c_df[<span class="st">&quot;gdp_2011&quot;</span>]:</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    y1_vals[<span class="st">&quot;gdp_2011&quot;</span>] <span class="op">=</span> y1_vals[<span class="st">&quot;gdp_2011&quot;</span>] <span class="op">+</span> v</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> v <span class="kw">in</span> c_df[<span class="st">&quot;gdp_2011_mb&quot;</span>]:</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    y1_vals[<span class="st">&quot;gdp_2011_mb&quot;</span>] <span class="op">=</span> y1_vals[<span class="st">&quot;gdp_2011_mb&quot;</span>] <span class="op">+</span> v</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> v <span class="kw">in</span> c_df[<span class="st">&quot;gdp_2017&quot;</span>]:</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    y1_vals[<span class="st">&quot;gdp_2017&quot;</span>] <span class="op">=</span> y1_vals[<span class="st">&quot;gdp_2017&quot;</span>] <span class="op">+</span> v</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  c_df <span class="op">=</span> y2_df[combined_df.code <span class="op">==</span> code]</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> v <span class="kw">in</span> c_df[<span class="st">&quot;gdp_2011&quot;</span>]:</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    y2_vals[<span class="st">&quot;gdp_2011&quot;</span>] <span class="op">=</span> y2_vals[<span class="st">&quot;gdp_2011&quot;</span>] <span class="op">+</span> v</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> v <span class="kw">in</span> c_df[<span class="st">&quot;gdp_2011_mb&quot;</span>]:</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    y2_vals[<span class="st">&quot;gdp_2011_mb&quot;</span>] <span class="op">=</span> y2_vals[<span class="st">&quot;gdp_2011_mb&quot;</span>] <span class="op">+</span> v</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> v <span class="kw">in</span> c_df[<span class="st">&quot;gdp_2017&quot;</span>]:</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    y2_vals[<span class="st">&quot;gdp_2017&quot;</span>] <span class="op">=</span> y2_vals[<span class="st">&quot;gdp_2017&quot;</span>] <span class="op">+</span> v</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>y1_vals[<span class="st">&quot;fac1&quot;</span>] <span class="op">=</span> y1_vals[<span class="st">&quot;gdp_2011&quot;</span>] <span class="op">/</span> y1_vals[<span class="st">&quot;gdp_2017&quot;</span>]</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>y1_vals[<span class="st">&quot;fac2&quot;</span>] <span class="op">=</span> y1_vals[<span class="st">&quot;gdp_2011_mb&quot;</span>] <span class="op">/</span> y1_vals[<span class="st">&quot;gdp_2017&quot;</span>]</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>y1_vals[<span class="st">&quot;fac2011&quot;</span>] <span class="op">=</span> y1_vals[<span class="st">&quot;gdp_2011_mb&quot;</span>] <span class="op">/</span> y1_vals[<span class="st">&quot;gdp_2011&quot;</span>]</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>y2_vals[<span class="st">&quot;fac1&quot;</span>] <span class="op">=</span> y2_vals[<span class="st">&quot;gdp_2011&quot;</span>] <span class="op">/</span> y2_vals[<span class="st">&quot;gdp_2017&quot;</span>]</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>y2_vals[<span class="st">&quot;fac2&quot;</span>] <span class="op">=</span> y2_vals[<span class="st">&quot;gdp_2011_mb&quot;</span>] <span class="op">/</span> y2_vals[<span class="st">&quot;gdp_2017&quot;</span>]</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>y2_vals[<span class="st">&quot;fac2011&quot;</span>] <span class="op">=</span> y2_vals[<span class="st">&quot;gdp_2011_mb&quot;</span>] <span class="op">/</span> y2_vals[<span class="st">&quot;gdp_2011&quot;</span>]</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y1_vals)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y2_vals)</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>combined_df[combined_df.code <span class="op">==</span> <span class="st">&quot;USA&quot;</span>].head()</span></code></pre></div>
<div class="output stream stdout">
<pre><code>{&#39;gdp_2011&#39;: 93952331058496.0, &#39;gdp_2011_mb&#39;: 93952331058496.0, &#39;gdp_2017&#39;: 98171539732185.94, &#39;fac1&#39;: 0.957022079054683, &#39;fac2&#39;: 0.957022079054683, &#39;fac2011&#39;: 1.0}
{&#39;gdp_2011&#39;: 107295416080637.0, &#39;gdp_2011_mb&#39;: 106491490024125.0, &#39;gdp_2017&#39;: 115602680525130.58, &#39;fac1&#39;: 0.9281395171222896, &#39;fac2&#39;: 0.92118530072471, &#39;fac2011&#39;: 0.9925073587868114}
</code></pre>
</div>
<div class="output execute_result" data-execution_count="81">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code</th>
      <th>country</th>
      <th>year</th>
      <th>gdp_pc_2011_mb</th>
      <th>gdp_pc_2011</th>
      <th>population</th>
      <th>consumption_for_person</th>
      <th>gdp_pc_2017</th>
      <th>population_cpc</th>
      <th>total_liters_consumed</th>
      <th>gdp_2011</th>
      <th>gdp_2011_mb</th>
      <th>gdp_2017</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>10720</th>
      <td>USA</td>
      <td>United States</td>
      <td>1950</td>
      <td>15241.0</td>
      <td>15241.0</td>
      <td>152271008</td>
      <td>-1.0</td>
      <td>-1.0</td>
      <td>-1</td>
      <td>-1.0</td>
      <td>2.320762e+12</td>
      <td>2.320762e+12</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>10721</th>
      <td>USA</td>
      <td>United States</td>
      <td>1951</td>
      <td>16126.0</td>
      <td>16126.0</td>
      <td>154878000</td>
      <td>-1.0</td>
      <td>-1.0</td>
      <td>160872264</td>
      <td>-1.0</td>
      <td>2.497563e+12</td>
      <td>2.497563e+12</td>
      <td>-1.0</td>
    </tr>
    <tr>
      <th>10722</th>
      <td>USA</td>
      <td>United States</td>
      <td>1952</td>
      <td>16443.0</td>
      <td>16443.0</td>
      <td>157552992</td>
      <td>-1.0</td>
      <td>-1.0</td>
      <td>163266026</td>
      <td>-1.0</td>
      <td>2.590644e+12</td>
      <td>2.590644e+12</td>
      <td>-1.0</td>
    </tr>
    <tr>
      <th>10723</th>
      <td>USA</td>
      <td>United States</td>
      <td>1953</td>
      <td>16917.0</td>
      <td>16917.0</td>
      <td>160184000</td>
      <td>-1.0</td>
      <td>-1.0</td>
      <td>165909996</td>
      <td>-1.0</td>
      <td>2.709833e+12</td>
      <td>2.709833e+12</td>
      <td>-1.0</td>
    </tr>
    <tr>
      <th>10724</th>
      <td>USA</td>
      <td>United States</td>
      <td>1954</td>
      <td>16513.0</td>
      <td>16513.0</td>
      <td>163026000</td>
      <td>-1.0</td>
      <td>-1.0</td>
      <td>168736390</td>
      <td>-1.0</td>
      <td>2.692048e+12</td>
      <td>2.692048e+12</td>
      <td>-1.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell markdown">
<h4>Created the world dataset</h4>
<p>We now have data for country and year but we want to make an easy to access data that has the yearly sum for many of these columns such as GDP and total alcohol consumption. We create a world dataset to accomplish this.</p>
</div>
<div class="cell code" data-execution_count="82">
<div class="sourceCode" id="cb14"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>world_df <span class="op">=</span> pd.DataFrame(columns<span class="op">=</span> combined_df.columns)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>world_miss_df <span class="op">=</span> pd.DataFrame(columns<span class="op">=</span> world_df.columns).drop(labels <span class="op">=</span> [<span class="st">&quot;country&quot;</span>, <span class="st">&quot;code&quot;</span>], axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>common_attrs <span class="op">=</span> [<span class="st">&quot;population&quot;</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;population_cpc&quot;</span>,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;consumption_for_person&quot;</span>,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;gdp_pc_2011_mb&quot;</span>,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;gdp_pc_2011&quot;</span>,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;gdp_pc_2017&quot;</span>,</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;total_liters_consumed&quot;</span>,</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;gdp_2011_mb&quot;</span>,</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;gdp_2011&quot;</span>,</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;gdp_2017&quot;</span>]</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>frac_attrs <span class="op">=</span>   [<span class="st">&quot;gdp_pc_2011_mb&quot;</span>,</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;gdp_pc_2011&quot;</span>,</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;gdp_pc_2017&quot;</span>,</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;consumption_for_person&quot;</span>]</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>map_attrs <span class="op">=</span>    {<span class="st">&quot;gdp_pc_2011_mb&quot;</span> : <span class="st">&quot;gdp_2011_mb&quot;</span>,</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;gdp_pc_2011&quot;</span> : <span class="st">&quot;gdp_2011&quot;</span>,</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;gdp_pc_2017&quot;</span>: <span class="st">&quot;gdp_2017&quot;</span>,</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;consumption_for_person&quot;</span> : <span class="st">&quot;total_liters_consumed&quot;</span>}</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> hit_years_arr:</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>  year_df <span class="op">=</span> combined_df[combined_df.year <span class="op">==</span> year]</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>  ser <span class="op">=</span> pd.Series()</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>  ser[<span class="st">&quot;country&quot;</span>] <span class="op">=</span> <span class="st">&quot;WORLD&quot;</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>  ser[<span class="st">&quot;code&quot;</span>] <span class="op">=</span> <span class="st">&quot;WORLD&quot;</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>  ser[<span class="st">&quot;year&quot;</span>] <span class="op">=</span> year</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>  ser_miss <span class="op">=</span> pd.Series()</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>  ser_miss[<span class="st">&quot;year&quot;</span>] <span class="op">=</span> year</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> attr <span class="kw">in</span> common_attrs:</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>    ser[attr] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>    ser_miss[attr] <span class="op">=</span> []</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> i, row <span class="kw">in</span> year_df.iterrows():</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> attr <span class="kw">in</span> common_attrs:</span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> row[attr] <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>        ser[attr] <span class="op">=</span> row[attr] <span class="op">+</span> ser[attr]</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span>:</span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>        ser_miss[attr].append(row[<span class="st">&quot;code&quot;</span>])</span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> attr <span class="kw">in</span> common_attrs:</span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ser[attr] <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>      ser[attr] <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> attr <span class="kw">in</span> frac_attrs:</span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ser[attr] <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>      ser[attr] <span class="op">=</span> ser[map_attrs[attr]] <span class="op">/</span> ser[<span class="st">&quot;population&quot;</span>]</span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>  world_df.loc[<span class="bu">len</span>(world_df.index)] <span class="op">=</span> ser</span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>  world_miss_df.loc[<span class="bu">len</span>(world_miss_df.index)] <span class="op">=</span> ser_miss</span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>world_df.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="82">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code</th>
      <th>country</th>
      <th>year</th>
      <th>gdp_pc_2011_mb</th>
      <th>gdp_pc_2011</th>
      <th>population</th>
      <th>consumption_for_person</th>
      <th>gdp_pc_2017</th>
      <th>population_cpc</th>
      <th>total_liters_consumed</th>
      <th>gdp_2011</th>
      <th>gdp_2011_mb</th>
      <th>gdp_2017</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>WORLD</td>
      <td>WORLD</td>
      <td>1950.0</td>
      <td>2840.316642</td>
      <td>3193.007878</td>
      <td>2514160984</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>8027735828641.0</td>
      <td>7141013283921.0</td>
      <td>166.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>WORLD</td>
      <td>WORLD</td>
      <td>1951.0</td>
      <td>2985.611376</td>
      <td>3355.141447</td>
      <td>2557931000</td>
      <td>-1</td>
      <td>-1</td>
      <td>2572198645</td>
      <td>-1</td>
      <td>8582220316169.0</td>
      <td>7636987893105.0</td>
      <td>-1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>WORLD</td>
      <td>WORLD</td>
      <td>1952.0</td>
      <td>3067.791124</td>
      <td>3456.668876</td>
      <td>2610876008</td>
      <td>-1</td>
      <td>-1</td>
      <td>2618839562</td>
      <td>-1</td>
      <td>9024933836048.0</td>
      <td>8009622243888.0</td>
      <td>-1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>WORLD</td>
      <td>WORLD</td>
      <td>1953.0</td>
      <td>3191.232846</td>
      <td>3591.33825</td>
      <td>2658728016</td>
      <td>-1</td>
      <td>-1</td>
      <td>2665387479</td>
      <td>-1</td>
      <td>9548391621048.0</td>
      <td>8484620172448.0</td>
      <td>-1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>WORLD</td>
      <td>WORLD</td>
      <td>1954.0</td>
      <td>3204.739537</td>
      <td>3626.651794</td>
      <td>2709558016</td>
      <td>-1</td>
      <td>-1</td>
      <td>2712412149</td>
      <td>-1</td>
      <td>9826623440912.0</td>
      <td>8683427700912.0</td>
      <td>-1</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell markdown">
<p>Using this data we can but the fraction of the GDP, alcohol consumed, and the population that a country represents for a given year. This is merged with the main data frame.</p>
</div>
<div class="cell code" data-execution_count="83">
<div class="sourceCode" id="cb15"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>comb_df <span class="op">=</span> pd.concat([combined_df,world_df], ignore_index <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>comb_df[<span class="st">&quot;frac_gdp_2011&quot;</span>] <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>comb_df[<span class="st">&quot;frac_gdp_2011_mb&quot;</span>] <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>comb_df[<span class="st">&quot;frac_gdp_2017&quot;</span>] <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>comb_df[<span class="st">&quot;frac_liters_consumed&quot;</span>] <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>comb_df[<span class="st">&quot;frac_population&quot;</span>] <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>comb_df[<span class="st">&quot;frac_population_cpc&quot;</span>] <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> hit_years_arr:</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  total <span class="op">=</span> world_df[world_df.year <span class="op">==</span> year].gdp_2011.to_numpy()[<span class="dv">0</span>]</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  comb_df.frac_gdp_2011[comb_df.year <span class="op">==</span> year] <span class="op">=</span> comb_df.gdp_2011 <span class="op">/</span> total</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  total <span class="op">=</span> world_df[world_df.year <span class="op">==</span> year].gdp_2011_mb.to_numpy()[<span class="dv">0</span>]</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  comb_df.frac_gdp_2011_mb[comb_df.year <span class="op">==</span> year] <span class="op">=</span> comb_df.gdp_2011_mb <span class="op">/</span> total</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  total <span class="op">=</span> world_df[world_df.year <span class="op">==</span> year].gdp_2017.to_numpy()[<span class="dv">0</span>]</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  comb_df.frac_gdp_2017[comb_df.year <span class="op">==</span> year] <span class="op">=</span> comb_df.gdp_2017 <span class="op">/</span> total</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>  total <span class="op">=</span> world_df[world_df.year <span class="op">==</span> year].total_liters_consumed.to_numpy()[<span class="dv">0</span>]</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>  comb_df.frac_liters_consumed[comb_df.year <span class="op">==</span> year] <span class="op">=</span> comb_df.total_liters_consumed <span class="op">/</span> total</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>  total <span class="op">=</span> world_df[world_df.year <span class="op">==</span> year].population.to_numpy()[<span class="dv">0</span>]</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>  comb_df.frac_population[comb_df.year <span class="op">==</span> year] <span class="op">=</span> comb_df.population <span class="op">/</span> total</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>  total <span class="op">=</span> world_df[world_df.year <span class="op">==</span> year].population_cpc.to_numpy()[<span class="dv">0</span>]</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>  comb_df.frac_population_cpc[comb_df.year <span class="op">==</span> year] <span class="op">=</span> comb_df.population_cpc <span class="op">/</span> total</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>comb_df.frac_gdp_2011[comb_df[<span class="st">&quot;gdp_2011&quot;</span>] <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>comb_df.frac_gdp_2011_mb[comb_df[<span class="st">&quot;gdp_2011_mb&quot;</span>] <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>comb_df.frac_gdp_2017[comb_df[<span class="st">&quot;gdp_2017&quot;</span>] <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>comb_df.frac_liters_consumed[comb_df[<span class="st">&quot;total_liters_consumed&quot;</span>] <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>comb_df.frac_population[comb_df[<span class="st">&quot;population&quot;</span>] <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>comb_df.frac_population_cpc[comb_df[<span class="st">&quot;population_cpc&quot;</span>] <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>comb_df[comb_df.code <span class="op">==</span> <span class="st">&quot;USA&quot;</span>].head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="83">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code</th>
      <th>country</th>
      <th>year</th>
      <th>gdp_pc_2011_mb</th>
      <th>gdp_pc_2011</th>
      <th>population</th>
      <th>consumption_for_person</th>
      <th>gdp_pc_2017</th>
      <th>population_cpc</th>
      <th>total_liters_consumed</th>
      <th>gdp_2011</th>
      <th>gdp_2011_mb</th>
      <th>gdp_2017</th>
      <th>frac_gdp_2011</th>
      <th>frac_gdp_2011_mb</th>
      <th>frac_gdp_2017</th>
      <th>frac_liters_consumed</th>
      <th>frac_population</th>
      <th>frac_population_cpc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>10586</th>
      <td>USA</td>
      <td>United States</td>
      <td>1950</td>
      <td>15241.0</td>
      <td>15241.0</td>
      <td>152271008</td>
      <td>-1.0</td>
      <td>-1.0</td>
      <td>-1</td>
      <td>-1.0</td>
      <td>2320762404864.0</td>
      <td>2320762404864.0</td>
      <td>1.0</td>
      <td>0.289093</td>
      <td>0.324991</td>
      <td>0.006024</td>
      <td>-1</td>
      <td>0.060565</td>
      <td>-1</td>
    </tr>
    <tr>
      <th>10587</th>
      <td>USA</td>
      <td>United States</td>
      <td>1951</td>
      <td>16126.0</td>
      <td>16126.0</td>
      <td>154878000</td>
      <td>-1.0</td>
      <td>-1.0</td>
      <td>160872264</td>
      <td>-1.0</td>
      <td>2497562542080.0</td>
      <td>2497562542080.0</td>
      <td>-1.0</td>
      <td>0.291016</td>
      <td>0.327035</td>
      <td>-1</td>
      <td>-1</td>
      <td>0.060548</td>
      <td>0.062543</td>
    </tr>
    <tr>
      <th>10588</th>
      <td>USA</td>
      <td>United States</td>
      <td>1952</td>
      <td>16443.0</td>
      <td>16443.0</td>
      <td>157552992</td>
      <td>-1.0</td>
      <td>-1.0</td>
      <td>163266026</td>
      <td>-1.0</td>
      <td>2590643847168.0</td>
      <td>2590643847168.0</td>
      <td>-1.0</td>
      <td>0.287054</td>
      <td>0.323441</td>
      <td>-1</td>
      <td>-1</td>
      <td>0.060345</td>
      <td>0.062343</td>
    </tr>
    <tr>
      <th>10589</th>
      <td>USA</td>
      <td>United States</td>
      <td>1953</td>
      <td>16917.0</td>
      <td>16917.0</td>
      <td>160184000</td>
      <td>-1.0</td>
      <td>-1.0</td>
      <td>165909996</td>
      <td>-1.0</td>
      <td>2709832597504.0</td>
      <td>2709832597504.0</td>
      <td>-1.0</td>
      <td>0.2838</td>
      <td>0.319382</td>
      <td>-1</td>
      <td>-1</td>
      <td>0.060248</td>
      <td>0.062246</td>
    </tr>
    <tr>
      <th>10590</th>
      <td>USA</td>
      <td>United States</td>
      <td>1954</td>
      <td>16513.0</td>
      <td>16513.0</td>
      <td>163026000</td>
      <td>-1.0</td>
      <td>-1.0</td>
      <td>168736390</td>
      <td>-1.0</td>
      <td>2692048224256.0</td>
      <td>2692048224256.0</td>
      <td>-1.0</td>
      <td>0.273955</td>
      <td>0.310021</td>
      <td>-1</td>
      <td>-1</td>
      <td>0.060167</td>
      <td>0.062209</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell markdown">
<p>We now have the data for the GDP and overall alcohol consumption per year for each country and in terms of the world. For our tutorial we want to compare the specific types of alcohol to one another. We import the dataset from the World Health Organization which has data about specific types of alcohol consumption by country. We remove the rows outside of our time range.</p>
</div>
<div class="cell code" data-execution_count="84">
<div class="sourceCode" id="cb16"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>acp_df <span class="op">=</span> pd.read_csv(<span class="st">&quot;Data/who-alcohol-per-cap.csv&quot;</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>acp_df <span class="op">=</span> pd.DataFrame(acp_df)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>acp_df <span class="op">=</span> acp_df.drop(labels<span class="op">=</span> [<span class="st">&quot;IndicatorCode&quot;</span>,<span class="st">&quot;Indicator&quot;</span>,<span class="st">&quot;ValueType&quot;</span>,<span class="st">&quot;ParentLocationCode&quot;</span>,<span class="st">&quot;ParentLocation&quot;</span>, <span class="st">&quot;Location type&quot;</span>,<span class="st">&quot;Period type&quot;</span>], axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>acp_df <span class="op">=</span> acp_df.rename(columns<span class="op">=</span>{<span class="st">&quot;SpatialDimValueCode&quot;</span> : <span class="st">&quot;code&quot;</span>})</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>filtered_acp_df <span class="op">=</span> pd.DataFrame(columns<span class="op">=</span> [<span class="st">&quot;code&quot;</span>, <span class="st">&quot;year&quot;</span>,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&quot;wine_mi&quot;</span>, <span class="st">&quot;wine_hi&quot;</span>, <span class="st">&quot;wine_lo&quot;</span>,</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&quot;beer_mi&quot;</span>, <span class="st">&quot;beer_hi&quot;</span>, <span class="st">&quot;beer_lo&quot;</span>, </span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&quot;spirits_mi&quot;</span>, <span class="st">&quot;spirits_hi&quot;</span>, <span class="st">&quot;spirits_lo&quot;</span>, </span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&quot;other_mi&quot;</span>, <span class="st">&quot;other_hi&quot;</span>, <span class="st">&quot;other_lo&quot;</span>,</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&quot;total_mi&quot;</span>, <span class="st">&quot;total_hi&quot;</span>, <span class="st">&quot;total_lo&quot;</span>])</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> code <span class="kw">in</span> pd.unique(acp_df.code):</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  c_df <span class="op">=</span> acp_df[acp_df.code <span class="op">==</span> code]</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> year <span class="kw">in</span> pd.unique(c_df.Period):</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    y_df <span class="op">=</span> c_df[c_df.Period <span class="op">==</span> year]</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    ser <span class="op">=</span> pd.Series(index<span class="op">=</span>filtered_acp_df.columns)</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    ser[<span class="st">&quot;code&quot;</span>] <span class="op">=</span> code</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    ser[<span class="st">&quot;year&quot;</span>] <span class="op">=</span> year</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    got_ser <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>    got_df <span class="op">=</span> y_df[y_df[<span class="st">&quot;Dim1ValueCode&quot;</span>] <span class="op">==</span> <span class="st">&quot;SA_WINE&quot;</span>]</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(got_df.index <span class="op">&gt;</span> <span class="dv">0</span>):</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>      got_ser <span class="op">=</span> got_df.iloc[<span class="dv">0</span>]</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>      ser[<span class="st">&quot;wine_hi&quot;</span>] <span class="op">=</span> got_ser[<span class="st">&quot;FactValueNumericHigh&quot;</span>]</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>      ser[<span class="st">&quot;wine_mi&quot;</span>] <span class="op">=</span> got_ser[<span class="st">&quot;FactValueNumeric&quot;</span>]</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>      ser[<span class="st">&quot;wine_lo&quot;</span>] <span class="op">=</span> got_ser[<span class="st">&quot;FactValueNumericLow&quot;</span>]</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>    got_df <span class="op">=</span> y_df[y_df[<span class="st">&quot;Dim1ValueCode&quot;</span>] <span class="op">==</span> <span class="st">&quot;SA_BEER&quot;</span>]</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(got_df.index <span class="op">&gt;</span> <span class="dv">0</span>):</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>      got_ser <span class="op">=</span> got_df.iloc[<span class="dv">0</span>]</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>      ser[<span class="st">&quot;beer_hi&quot;</span>] <span class="op">=</span> got_ser[<span class="st">&quot;FactValueNumericHigh&quot;</span>]</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>      ser[<span class="st">&quot;beer_mi&quot;</span>] <span class="op">=</span> got_ser[<span class="st">&quot;FactValueNumeric&quot;</span>]</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>      ser[<span class="st">&quot;beer_lo&quot;</span>] <span class="op">=</span> got_ser[<span class="st">&quot;FactValueNumericLow&quot;</span>]</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>    got_df <span class="op">=</span> y_df[y_df[<span class="st">&quot;Dim1ValueCode&quot;</span>] <span class="op">==</span> <span class="st">&quot;SA_SPIRITS&quot;</span>]</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(got_df.index <span class="op">&gt;</span> <span class="dv">0</span>):</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>      got_ser <span class="op">=</span> got_df.iloc[<span class="dv">0</span>]</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>      ser[<span class="st">&quot;spirits_hi&quot;</span>] <span class="op">=</span> got_ser[<span class="st">&quot;FactValueNumericHigh&quot;</span>]</span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>      ser[<span class="st">&quot;spirits_mi&quot;</span>] <span class="op">=</span> got_ser[<span class="st">&quot;FactValueNumeric&quot;</span>]</span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>      ser[<span class="st">&quot;spirits_lo&quot;</span>] <span class="op">=</span> got_ser[<span class="st">&quot;FactValueNumericLow&quot;</span>]</span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>    got_df <span class="op">=</span> y_df[y_df[<span class="st">&quot;Dim1ValueCode&quot;</span>] <span class="op">==</span> <span class="st">&quot;SA_OTHER_ALCOHOL&quot;</span>]</span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(got_df.index <span class="op">&gt;</span> <span class="dv">0</span>):</span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>      got_ser <span class="op">=</span> got_df.iloc[<span class="dv">0</span>]</span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a>      ser[<span class="st">&quot;other_hi&quot;</span>] <span class="op">=</span> got_ser[<span class="st">&quot;FactValueNumericHigh&quot;</span>]</span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>      ser[<span class="st">&quot;other_mi&quot;</span>] <span class="op">=</span> got_ser[<span class="st">&quot;FactValueNumeric&quot;</span>]</span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a>      ser[<span class="st">&quot;other_lo&quot;</span>] <span class="op">=</span> got_ser[<span class="st">&quot;FactValueNumericLow&quot;</span>]</span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>    got_df <span class="op">=</span> y_df[y_df[<span class="st">&quot;Dim1ValueCode&quot;</span>] <span class="op">==</span> <span class="st">&quot;SA_TOTAL&quot;</span>]</span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(got_df.index <span class="op">&gt;</span> <span class="dv">0</span>):</span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a>      got_ser <span class="op">=</span> got_df.iloc[<span class="dv">0</span>]</span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a>      ser[<span class="st">&quot;total_hi&quot;</span>] <span class="op">=</span> got_ser[<span class="st">&quot;FactValueNumericHigh&quot;</span>]</span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a>      ser[<span class="st">&quot;total_mi&quot;</span>] <span class="op">=</span> got_ser[<span class="st">&quot;FactValueNumeric&quot;</span>]</span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a>      ser[<span class="st">&quot;total_lo&quot;</span>] <span class="op">=</span> got_ser[<span class="st">&quot;FactValueNumericLow&quot;</span>]</span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a>    filtered_acp_df.loc[<span class="bu">len</span>(filtered_acp_df.index)] <span class="op">=</span> ser</span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a>hit_acp_df <span class="op">=</span> filtered_acp_df[filtered_acp_df.code.isin(hit_codes)]</span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a>hit_acp_df <span class="op">=</span> hit_acp_df[hit_acp_df.year.isin(hit_years_arr)]</span>
<span id="cb16-62"><a href="#cb16-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-63"><a href="#cb16-63" aria-hidden="true" tabindex="-1"></a>hit_acp_df <span class="op">=</span> hit_acp_df.fillna(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb16-64"><a href="#cb16-64" aria-hidden="true" tabindex="-1"></a>hit_acp_df.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="84">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code</th>
      <th>year</th>
      <th>wine_mi</th>
      <th>wine_hi</th>
      <th>wine_lo</th>
      <th>beer_mi</th>
      <th>beer_hi</th>
      <th>beer_lo</th>
      <th>spirits_mi</th>
      <th>spirits_hi</th>
      <th>spirits_lo</th>
      <th>other_mi</th>
      <th>other_hi</th>
      <th>other_lo</th>
      <th>total_mi</th>
      <th>total_hi</th>
      <th>total_lo</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3</th>
      <td>AFG</td>
      <td>2016</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.01</td>
      <td>0.014</td>
      <td>0.006</td>
      <td>0.00</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.01</td>
      <td>0.014</td>
      <td>0.006</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AFG</td>
      <td>2015</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.00</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.00</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.00</td>
      <td>0.000</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>5</th>
      <td>AFG</td>
      <td>2014</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.01</td>
      <td>0.014</td>
      <td>0.006</td>
      <td>0.00</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.01</td>
      <td>0.014</td>
      <td>0.006</td>
    </tr>
    <tr>
      <th>6</th>
      <td>AFG</td>
      <td>2013</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.00</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.01</td>
      <td>0.014</td>
      <td>0.006</td>
      <td>0.01</td>
      <td>0.014</td>
      <td>0.006</td>
    </tr>
    <tr>
      <th>7</th>
      <td>AFG</td>
      <td>2012</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.00</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.01</td>
      <td>0.014</td>
      <td>0.006</td>
      <td>0.01</td>
      <td>0.014</td>
      <td>0.006</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell code" data-execution_count="85">
<div class="sourceCode" id="cb17"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>miss_year <span class="op">=</span> pd.DataFrame(columns<span class="op">=</span>[<span class="st">&quot;year&quot;</span>,</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">&quot;miss_wine&quot;</span>, <span class="st">&quot;miss_wine_range&quot;</span>,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">&quot;miss_beer&quot;</span>, <span class="st">&quot;miss_beer_range&quot;</span>, </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">&quot;miss_spirits&quot;</span>, <span class="st">&quot;miss_spirits_range&quot;</span>, </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">&quot;miss_other&quot;</span>, <span class="st">&quot;miss_other_range&quot;</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">&quot;miss_total&quot;</span>, <span class="st">&quot;miss_total_range&quot;</span>])</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> hit_years_arr:</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  year_df <span class="op">=</span> hit_acp_df[hit_acp_df.year <span class="op">==</span> year]</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="bu">len</span>(year_df.index) <span class="op">&lt;</span> <span class="dv">1</span>:</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span><span class="op">==</span><span class="dv">0</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>:</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    offset <span class="op">=</span> <span class="bu">len</span>(hit_codes) <span class="op">-</span> <span class="bu">len</span>(year_df)</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    ser <span class="op">=</span> pd.Series(index <span class="op">=</span> miss_year.columns)</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    ser[<span class="st">&quot;miss_wine&quot;</span>] <span class="op">=</span> <span class="bu">len</span>(year_df[year_df.wine_mi <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>].index) <span class="op">+</span> offset</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    ser[<span class="st">&quot;miss_wine_range&quot;</span>] <span class="op">=</span> <span class="bu">len</span>(year_df[(year_df.wine_hi <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>) <span class="op">|</span> (year_df.wine_lo <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>)].index) <span class="op">+</span> offset</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>    ser[<span class="st">&quot;miss_beer&quot;</span>] <span class="op">=</span> <span class="bu">len</span>(year_df[year_df.beer_mi <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>].index) <span class="op">+</span> offset</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>    ser[<span class="st">&quot;miss_beer_range&quot;</span>] <span class="op">=</span> <span class="bu">len</span>(year_df[(year_df.beer_hi <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>) <span class="op">|</span> (year_df.beer_lo <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>)].index) <span class="op">+</span> offset</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>    ser[<span class="st">&quot;miss_spirits&quot;</span>] <span class="op">=</span> <span class="bu">len</span>(year_df[year_df.spirits_mi <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>].index) <span class="op">+</span> offset</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>    ser[<span class="st">&quot;miss_spirits_range&quot;</span>] <span class="op">=</span> <span class="bu">len</span>(year_df[(year_df.spirits_hi <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>) <span class="op">|</span> (year_df.spirits_lo <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>)].index) <span class="op">+</span> offset</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>    ser[<span class="st">&quot;miss_other&quot;</span>] <span class="op">=</span> <span class="bu">len</span>(year_df[year_df.other_mi <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>].index) <span class="op">+</span> offset</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>    ser[<span class="st">&quot;miss_other_range&quot;</span>] <span class="op">=</span> <span class="bu">len</span>(year_df[(year_df.other_hi <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>) <span class="op">|</span> (year_df.other_lo <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>)].index) <span class="op">+</span> offset</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>    ser[<span class="st">&quot;miss_total&quot;</span>] <span class="op">=</span> <span class="bu">len</span>(year_df[year_df.total_mi <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>].index) <span class="op">+</span> offset</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>    ser[<span class="st">&quot;miss_total_range&quot;</span>] <span class="op">=</span> <span class="bu">len</span>(year_df[(year_df.total_hi <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>) <span class="op">|</span> (year_df.total_lo <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>)].index) <span class="op">+</span> offset</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>    ser[<span class="st">&quot;year&quot;</span>] <span class="op">=</span> year</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>    miss_year.loc[<span class="bu">len</span>(miss_year.index)] <span class="op">=</span> ser</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>miss_year[<span class="st">&quot;score&quot;</span>] <span class="op">=</span> <span class="dv">200</span> <span class="op">-</span> (<span class="dv">25</span> <span class="op">*</span> miss_year[<span class="st">&#39;miss_beer&#39;</span>]<span class="op">/</span><span class="bu">len</span>(hit_codes) <span class="op">+</span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">5</span> <span class="op">*</span> miss_year[<span class="st">&#39;miss_beer_range&#39;</span>]<span class="op">/</span><span class="bu">len</span>(hit_codes) <span class="op">+</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">25</span> <span class="op">*</span> miss_year[<span class="st">&#39;miss_wine&#39;</span>]<span class="op">/</span><span class="bu">len</span>(hit_codes) <span class="op">+</span> </span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">5</span> <span class="op">*</span> miss_year[<span class="st">&#39;miss_wine_range&#39;</span>]<span class="op">/</span><span class="bu">len</span>(hit_codes) <span class="op">+</span> </span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">25</span> <span class="op">*</span> miss_year[<span class="st">&#39;miss_spirits&#39;</span>]<span class="op">/</span><span class="bu">len</span>(hit_codes) <span class="op">+</span> </span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">5</span> <span class="op">*</span> miss_year[<span class="st">&#39;miss_spirits_range&#39;</span>]<span class="op">/</span><span class="bu">len</span>(hit_codes) <span class="op">+</span> </span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">10</span> <span class="op">*</span> miss_year[<span class="st">&#39;miss_other&#39;</span>]<span class="op">/</span><span class="bu">len</span>(hit_codes) <span class="op">+</span> </span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">5</span> <span class="op">*</span> miss_year[<span class="st">&#39;miss_other_range&#39;</span>]<span class="op">/</span><span class="bu">len</span>(hit_codes) <span class="op">+</span> </span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">90</span> <span class="op">*</span> miss_year[<span class="st">&#39;miss_total&#39;</span>]<span class="op">/</span><span class="bu">len</span>(hit_codes) <span class="op">+</span> </span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">5</span> <span class="op">*</span> miss_year[<span class="st">&#39;miss_total_range&#39;</span>]<span class="op">/</span><span class="bu">len</span>(hit_codes))</span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>miss_year.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="85">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year</th>
      <th>miss_wine</th>
      <th>miss_wine_range</th>
      <th>miss_beer</th>
      <th>miss_beer_range</th>
      <th>miss_spirits</th>
      <th>miss_spirits_range</th>
      <th>miss_other</th>
      <th>miss_other_range</th>
      <th>miss_total</th>
      <th>miss_total_range</th>
      <th>score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1960.0</td>
      <td>164.0</td>
      <td>166.0</td>
      <td>164.0</td>
      <td>166.0</td>
      <td>164.0</td>
      <td>166.0</td>
      <td>166.0</td>
      <td>166.0</td>
      <td>164.0</td>
      <td>166.0</td>
      <td>1.987952</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1961.0</td>
      <td>40.0</td>
      <td>166.0</td>
      <td>40.0</td>
      <td>166.0</td>
      <td>40.0</td>
      <td>166.0</td>
      <td>123.0</td>
      <td>166.0</td>
      <td>40.0</td>
      <td>166.0</td>
      <td>127.831325</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1962.0</td>
      <td>38.0</td>
      <td>166.0</td>
      <td>38.0</td>
      <td>166.0</td>
      <td>38.0</td>
      <td>166.0</td>
      <td>123.0</td>
      <td>166.0</td>
      <td>38.0</td>
      <td>166.0</td>
      <td>129.819277</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1963.0</td>
      <td>31.0</td>
      <td>166.0</td>
      <td>31.0</td>
      <td>166.0</td>
      <td>31.0</td>
      <td>166.0</td>
      <td>122.0</td>
      <td>166.0</td>
      <td>31.0</td>
      <td>166.0</td>
      <td>136.837349</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1964.0</td>
      <td>31.0</td>
      <td>166.0</td>
      <td>31.0</td>
      <td>166.0</td>
      <td>31.0</td>
      <td>166.0</td>
      <td>122.0</td>
      <td>166.0</td>
      <td>31.0</td>
      <td>166.0</td>
      <td>136.837349</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell markdown">
<p>We then extract the viable data entries and merge them into our main data frame. The rows are merged if they have the same code and year.</p>
</div>
<div class="cell code" data-execution_count="86">
<div class="sourceCode" id="cb18"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>viable_years <span class="op">=</span> miss_year[miss_year.score <span class="op">&gt;</span> <span class="dv">180</span>].year.to_numpy()</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>viable_acp_df <span class="op">=</span> hit_acp_df[hit_acp_df.year.isin(viable_years)]</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>new_comb_df <span class="op">=</span> pd.merge(how <span class="op">=</span> <span class="st">&quot;left&quot;</span>, left <span class="op">=</span> comb_df[comb_df.year.isin(viable_years)], right <span class="op">=</span> viable_acp_df, on<span class="op">=</span>[<span class="st">&quot;code&quot;</span>,<span class="st">&quot;year&quot;</span>])</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>new_comb_df.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="86">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code</th>
      <th>country</th>
      <th>year</th>
      <th>gdp_pc_2011_mb</th>
      <th>gdp_pc_2011</th>
      <th>population</th>
      <th>consumption_for_person</th>
      <th>gdp_pc_2017</th>
      <th>population_cpc</th>
      <th>total_liters_consumed</th>
      <th>...</th>
      <th>beer_lo</th>
      <th>spirits_mi</th>
      <th>spirits_hi</th>
      <th>spirits_lo</th>
      <th>other_mi</th>
      <th>other_hi</th>
      <th>other_lo</th>
      <th>total_mi</th>
      <th>total_hi</th>
      <th>total_lo</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AFG</td>
      <td>Afghanistan</td>
      <td>2000</td>
      <td>735.0</td>
      <td>735.0</td>
      <td>22461000</td>
      <td>-1.0</td>
      <td>-1.0</td>
      <td>20779957</td>
      <td>-1.0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AFG</td>
      <td>Afghanistan</td>
      <td>2001</td>
      <td>692.0</td>
      <td>692.0</td>
      <td>22507000</td>
      <td>-1.0</td>
      <td>-1.0</td>
      <td>21606992</td>
      <td>-1.0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AFG</td>
      <td>Afghanistan</td>
      <td>2002</td>
      <td>1088.0</td>
      <td>1088.0</td>
      <td>23600000</td>
      <td>-1.0</td>
      <td>1189.784668</td>
      <td>22600774</td>
      <td>-1.0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AFG</td>
      <td>Afghanistan</td>
      <td>2003</td>
      <td>1112.0</td>
      <td>1112.0</td>
      <td>25005000</td>
      <td>-1.0</td>
      <td>1235.810063</td>
      <td>23680871</td>
      <td>-1.0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AFG</td>
      <td>Afghanistan</td>
      <td>2004</td>
      <td>1107.0</td>
      <td>1107.0</td>
      <td>25698000</td>
      <td>-1.0</td>
      <td>1200.278013</td>
      <td>24726689</td>
      <td>-1.0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>5 rows Ã— 34 columns</p>
</div>
</div>
</div>
<div class="cell markdown">
<p>Using the information from the from the <a href = "https://www.who.int/data/gho/data/indicators/indicator-details/GHO/alcohol-recorded-per-capita-(15-)-consumption-(in-litres-of-pure-alcohol)">World Health Organization</a>, we can calculate values of volume per type of alcohol consumed. For our purposes the average for wine, beer, spirits, and other were taken to use against the data collected in the previous section.</p>
</div>
<div class="cell code" data-execution_count="87">
<div class="sourceCode" id="cb19"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># From the World Health Organization</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>wine_abv <span class="op">=</span> [<span class="fl">0.12</span>,<span class="fl">0.09</span>,<span class="fl">0.16</span>]</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>beer_abv <span class="op">=</span> [<span class="fl">0.05</span>]</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>spirits_abv <span class="op">=</span> [<span class="fl">0.4</span>,<span class="fl">0.3</span>]</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>other_abv <span class="op">=</span> [<span class="fl">0.05</span>,<span class="fl">0.05</span>,<span class="fl">0.17</span>,<span class="fl">0.18</span>,<span class="fl">0.09</span>,<span class="fl">0.09</span>,<span class="fl">0.09</span>]</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>wine_abv <span class="op">=</span> np.mean(wine_abv)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>beer_abv <span class="op">=</span> np.mean(beer_abv)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>spirits_abv <span class="op">=</span> np.mean(spirits_abv)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>other_abv <span class="op">=</span> np.mean(other_abv)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>new_comb_df[<span class="st">&quot;wine_mi_vol&quot;</span>] <span class="op">=</span> new_comb_df[<span class="st">&quot;wine_mi&quot;</span>] <span class="op">/</span> wine_abv</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>new_comb_df[<span class="st">&quot;wine_hi_vol&quot;</span>] <span class="op">=</span> new_comb_df[<span class="st">&quot;wine_hi&quot;</span>] <span class="op">/</span> wine_abv</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>new_comb_df[<span class="st">&quot;wine_lo_vol&quot;</span>] <span class="op">=</span> new_comb_df[<span class="st">&quot;wine_lo&quot;</span>] <span class="op">/</span> wine_abv</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>new_comb_df[<span class="st">&quot;beer_mi_vol&quot;</span>] <span class="op">=</span> new_comb_df[<span class="st">&quot;beer_mi&quot;</span>] <span class="op">/</span> beer_abv</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>new_comb_df[<span class="st">&quot;beer_hi_vol&quot;</span>] <span class="op">=</span> new_comb_df[<span class="st">&quot;beer_hi&quot;</span>] <span class="op">/</span> beer_abv</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>new_comb_df[<span class="st">&quot;beer_lo_vol&quot;</span>] <span class="op">=</span> new_comb_df[<span class="st">&quot;beer_lo&quot;</span>] <span class="op">/</span> beer_abv</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>new_comb_df[<span class="st">&quot;spirits_mi_vol&quot;</span>] <span class="op">=</span> new_comb_df[<span class="st">&quot;spirits_mi&quot;</span>] <span class="op">/</span> spirits_abv</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>new_comb_df[<span class="st">&quot;spirits_hi_vol&quot;</span>] <span class="op">=</span> new_comb_df[<span class="st">&quot;spirits_hi&quot;</span>] <span class="op">/</span> spirits_abv</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>new_comb_df[<span class="st">&quot;spirits_lo_vol&quot;</span>] <span class="op">=</span> new_comb_df[<span class="st">&quot;spirits_lo&quot;</span>] <span class="op">/</span> spirits_abv</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>new_comb_df[<span class="st">&quot;other_mi_vol&quot;</span>] <span class="op">=</span> new_comb_df[<span class="st">&quot;other_mi&quot;</span>] <span class="op">/</span> other_abv</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>new_comb_df[<span class="st">&quot;other_hi_vol&quot;</span>] <span class="op">=</span> new_comb_df[<span class="st">&quot;other_hi&quot;</span>] <span class="op">/</span> other_abv</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>new_comb_df[<span class="st">&quot;other_lo_vol&quot;</span>] <span class="op">=</span> new_comb_df[<span class="st">&quot;other_lo&quot;</span>] <span class="op">/</span> other_abv</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>new_comb_df[<span class="st">&quot;total_mi_vol&quot;</span>] <span class="op">=</span> new_comb_df[<span class="st">&quot;wine_mi_vol&quot;</span>] <span class="op">+</span> new_comb_df[<span class="st">&quot;beer_mi_vol&quot;</span>] <span class="op">+</span> new_comb_df[<span class="st">&quot;spirits_mi_vol&quot;</span>] <span class="op">+</span> new_comb_df[<span class="st">&quot;other_mi_vol&quot;</span>]</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>new_comb_df[<span class="st">&quot;total_hi_vol&quot;</span>] <span class="op">=</span> new_comb_df[<span class="st">&quot;wine_hi_vol&quot;</span>] <span class="op">+</span> new_comb_df[<span class="st">&quot;beer_hi_vol&quot;</span>] <span class="op">+</span> new_comb_df[<span class="st">&quot;spirits_hi_vol&quot;</span>] <span class="op">+</span> new_comb_df[<span class="st">&quot;other_hi_vol&quot;</span>]</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>new_comb_df[<span class="st">&quot;total_lo_vol&quot;</span>] <span class="op">=</span> new_comb_df[<span class="st">&quot;wine_lo_vol&quot;</span>] <span class="op">+</span> new_comb_df[<span class="st">&quot;beer_lo_vol&quot;</span>] <span class="op">+</span> new_comb_df[<span class="st">&quot;spirits_lo_vol&quot;</span>] <span class="op">+</span> new_comb_df[<span class="st">&quot;other_lo_vol&quot;</span>]</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>new_comb_df[<span class="st">&quot;consumption_for_person&quot;</span>][new_comb_df.consumption_for_person <span class="op">&lt;</span> <span class="dv">0</span>] <span class="op">=</span> new_comb_df[<span class="st">&quot;total_mi&quot;</span>]</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>new_comb_df[<span class="st">&quot;fluid_vol_mi&quot;</span>] <span class="op">=</span> new_comb_df[<span class="st">&quot;total_mi_vol&quot;</span>] <span class="op">*</span> new_comb_df[<span class="st">&quot;population&quot;</span>]</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>new_comb_df[<span class="st">&quot;vol_vs_pure_mi&quot;</span>] <span class="op">=</span> new_comb_df[<span class="st">&quot;total_mi&quot;</span>] <span class="op">/</span> new_comb_df[<span class="st">&quot;total_mi_vol&quot;</span>]</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>new_comb_df[new_comb_df.code <span class="op">==</span> <span class="st">&quot;USA&quot;</span>].head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="87">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code</th>
      <th>country</th>
      <th>year</th>
      <th>gdp_pc_2011_mb</th>
      <th>gdp_pc_2011</th>
      <th>population</th>
      <th>consumption_for_person</th>
      <th>gdp_pc_2017</th>
      <th>population_cpc</th>
      <th>total_liters_consumed</th>
      <th>...</th>
      <th>spirits_hi_vol</th>
      <th>spirits_lo_vol</th>
      <th>other_mi_vol</th>
      <th>other_hi_vol</th>
      <th>other_lo_vol</th>
      <th>total_mi_vol</th>
      <th>total_hi_vol</th>
      <th>total_lo_vol</th>
      <th>fluid_vol_mi</th>
      <th>vol_vs_pure_mi</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2686</th>
      <td>USA</td>
      <td>United States</td>
      <td>2000</td>
      <td>45887.0</td>
      <td>45887.0</td>
      <td>282737984</td>
      <td>9.19</td>
      <td>50124.891177</td>
      <td>281710914</td>
      <td>2588923299.66</td>
      <td>...</td>
      <td>9.600000</td>
      <td>4.085714</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>108.800772</td>
      <td>150.572973</td>
      <td>66.161390</td>
      <td>30762110989.689571</td>
      <td>0.075459</td>
    </tr>
    <tr>
      <th>2687</th>
      <td>USA</td>
      <td>United States</td>
      <td>2001</td>
      <td>45878.0</td>
      <td>45878.0</td>
      <td>285550016</td>
      <td>8.25</td>
      <td>50126.720222</td>
      <td>284607992</td>
      <td>-1.0</td>
      <td>...</td>
      <td>9.771429</td>
      <td>4.400000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>109.600772</td>
      <td>154.268726</td>
      <td>66.637838</td>
      <td>31296502255.542858</td>
      <td>0.075273</td>
    </tr>
    <tr>
      <th>2688</th>
      <td>USA</td>
      <td>United States</td>
      <td>2002</td>
      <td>46267.0</td>
      <td>46267.0</td>
      <td>288212000</td>
      <td>8.33</td>
      <td>50528.788577</td>
      <td>287279312</td>
      <td>-1.0</td>
      <td>...</td>
      <td>9.600000</td>
      <td>4.114286</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>110.249421</td>
      <td>153.908108</td>
      <td>67.514286</td>
      <td>31775206081.853279</td>
      <td>0.075556</td>
    </tr>
    <tr>
      <th>2689</th>
      <td>USA</td>
      <td>United States</td>
      <td>2003</td>
      <td>47158.0</td>
      <td>47158.0</td>
      <td>290700000</td>
      <td>8.4</td>
      <td>51529.726404</td>
      <td>289815567</td>
      <td>-1.0</td>
      <td>...</td>
      <td>10.114286</td>
      <td>4.485714</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>109.316602</td>
      <td>150.265637</td>
      <td>68.610039</td>
      <td>31778336293.436287</td>
      <td>0.076841</td>
    </tr>
    <tr>
      <th>2690</th>
      <td>USA</td>
      <td>United States</td>
      <td>2004</td>
      <td>48493.0</td>
      <td>48493.0</td>
      <td>293401984</td>
      <td>8.48</td>
      <td>52994.55196</td>
      <td>292354663</td>
      <td>-1.0</td>
      <td>...</td>
      <td>10.400000</td>
      <td>4.514286</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>109.645560</td>
      <td>150.081081</td>
      <td>67.719691</td>
      <td>32170224795.477993</td>
      <td>0.077340</td>
    </tr>
  </tbody>
</table>
<p>5 rows Ã— 51 columns</p>
</div>
</div>
</div>
<div class="cell markdown">
<hr>
</div>
<div class="cell markdown">
<center>
    <h3>Exploratory data analysis</h3>
</center>
<p>To show a relationship between GDP and alcohol consumption, we graph the median consumption per person and the logarithmically scaled GDP per capita.</p>
</div>
<div class="cell code" data-execution_count="88">
<div class="sourceCode" id="cb20"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>[<span class="dv">10</span>,<span class="dv">6</span>])</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Logrithmically Scalled GDP per Capita vs Meidum Consumption per Person&quot;</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;GDP per Capita (log)&quot;</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Medium Consumption per Person&quot;</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> code <span class="kw">in</span> hit_codes:</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  plottable <span class="op">=</span> new_comb_df.fillna(<span class="op">-</span><span class="dv">1</span>)[new_comb_df.code <span class="op">==</span> code]</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  plottable <span class="op">=</span> plottable[plottable.population <span class="op">!=</span> <span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  plot_gdp <span class="op">=</span> []</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  plot_medcon <span class="op">=</span> []</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> i, row <span class="kw">in</span> plottable.iterrows():</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    plot_gdp.append(np.log2(row.gdp_pc_2011))</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    plot_medcon.append(row.total_mi)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  plt.plot(plot_gdp, plot_medcon)</span></code></pre></div>
<div class="output display_data">
<p><img src="vertopal_31107dfa9deb4a6aa742acd4bf7083c0/9d75989c7be30f49d2e1f8f36ca7ceade7948fe4.png" /></p>
</div>
</div>
<div class="cell markdown">
<p>Each line on the graph represents a country in our data. Looking at the data we can see a vague pattern in the data. The data becomes much clearer when you create the same graph but over time.</p>
</div>
<div class="cell code" data-execution_count="89">
<div class="sourceCode" id="cb21"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">12</span>))</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> plt.axes(projection<span class="op">=</span><span class="st">&#39;3d&#39;</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>new_comb_df <span class="op">=</span> new_comb_df.fillna(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">&#39;GDP per Capita (log)&#39;</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">&#39;Year&#39;</span>)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>ax.set_zlabel(<span class="st">&#39;Medium Consumption per Person&#39;</span>)<span class="op">;</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>ax.title.set_text(<span class="st">&quot;Logrithmically Scalled GDP per Capita vs. Medium Consumption per Person over time&quot;</span>)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>all_pts <span class="op">=</span> []</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>all_x <span class="op">=</span> []</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>all_y <span class="op">=</span> []</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>all_z <span class="op">=</span> []</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> code <span class="kw">in</span> hit_codes:</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  x <span class="op">=</span> []</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  y <span class="op">=</span> []</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  z <span class="op">=</span> []</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>  code_df <span class="op">=</span> new_comb_df[new_comb_df.code <span class="op">==</span> code]</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> year <span class="kw">in</span> pd.unique(new_comb_df.year):</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>    y_df <span class="op">=</span> code_df[code_df.year <span class="op">==</span> year]</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>    xvar <span class="op">=</span> np.log2(y_df[<span class="st">&quot;gdp_pc_2011&quot;</span>].to_numpy()[<span class="dv">0</span>])</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>    yvar <span class="op">=</span> year</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>    zvar <span class="op">=</span> y_df[<span class="st">&quot;total_mi&quot;</span>].to_numpy()[<span class="dv">0</span>]</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> xvar <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> yvar <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> zvar <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>      x.append(xvar)</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>      y.append(yvar)</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>      z.append(zvar)</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>      all_pts.append([xvar,yvar,zvar])</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>      all_x.append(xvar)</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>      all_y.append(yvar)</span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>      all_z.append(zvar)</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>  ax.plot3D(x,y,z)</span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>  ax.scatter3D(x,y,z)</span></code></pre></div>
<div class="output display_data">
<p><img src="vertopal_31107dfa9deb4a6aa742acd4bf7083c0/52a53308bccf6663e65a8146016b83b6578e61a6.png" /></p>
</div>
</div>
<div class="cell markdown">
<p>We attempted to create a gaussian blur however we did not end up using it. This is because as an entropy function it lost a large amount of the data.</p>
</div>
<div class="cell code" data-execution_count="90">
<div class="sourceCode" id="cb22"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _gaussian_kernel1d(sigma, order, radius):</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Computes a 1-D Gaussian convolution kernel.</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> order <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">&#39;order must be non-negative&#39;</span>)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    exponent_range <span class="op">=</span> np.arange(order <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    sigma2 <span class="op">=</span> sigma <span class="op">*</span> sigma</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> np.arange(<span class="op">-</span>radius, radius<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    phi_x <span class="op">=</span> np.exp(<span class="op">-</span><span class="fl">0.5</span> <span class="op">/</span> sigma2 <span class="op">*</span> x <span class="op">**</span> <span class="dv">2</span>)</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    phi_x <span class="op">=</span> phi_x <span class="op">/</span> phi_x.<span class="bu">sum</span>()</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> order <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> phi_x</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>        q <span class="op">=</span> np.zeros(order <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>        q[<span class="dv">0</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>        D <span class="op">=</span> np.diag(exponent_range[<span class="dv">1</span>:], <span class="dv">1</span>)  <span class="co"># D @ q(x) = q&#39;(x)</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>        P <span class="op">=</span> np.diag(np.ones(order)<span class="op">/-</span>sigma2, <span class="op">-</span><span class="dv">1</span>)  <span class="co"># P @ q(x) = q(x) * p&#39;(x)</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>        Q_deriv <span class="op">=</span> D <span class="op">+</span> P</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(order):</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>            q <span class="op">=</span> Q_deriv.dot(q)</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>        q <span class="op">=</span> (x[:, <span class="va">None</span>] <span class="op">**</span> exponent_range).dot(q)</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> q <span class="op">*</span> phi_x</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="91">
<div class="sourceCode" id="cb23"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_surf_plot_points(pts, step, smooth_fac, f, sigma <span class="op">=</span> <span class="dv">100</span>, truncate <span class="op">=</span> <span class="fl">4.0</span>, add_x_bound <span class="op">=</span> (<span class="dv">0</span>,<span class="dv">0</span>), add_y_bound <span class="op">=</span> (<span class="dv">0</span>,<span class="dv">0</span>), blur_iter <span class="op">=</span> <span class="dv">1</span>, smooth_kind <span class="op">=</span> <span class="dv">2</span>, adj_blur <span class="op">=</span> <span class="va">True</span>):</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  order <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  x_min <span class="op">=</span> np.Infinity</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  x_max <span class="op">=</span> <span class="op">-</span>np.Infinity</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  y_min <span class="op">=</span> np.Infinity</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  y_max <span class="op">=</span> <span class="op">-</span>np.Infinity</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> pt <span class="kw">in</span> pts:</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> pt[<span class="dv">0</span>]</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> pt[<span class="dv">1</span>]</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x <span class="op">&lt;</span> x_min:</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>      x_min <span class="op">=</span> x</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> x <span class="op">&gt;</span> x_max:</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>      x_max <span class="op">=</span> x</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> y <span class="op">&lt;</span> y_min:</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>      y_min <span class="op">=</span> y</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> y <span class="op">&gt;</span> y_max:</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>      y_max <span class="op">=</span> y</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>  x_add <span class="op">=</span> (add_x_bound[<span class="dv">0</span>] <span class="op">+</span> add_x_bound[<span class="dv">1</span>])<span class="op">/</span>((x_max <span class="op">-</span> x_min)<span class="op">/</span>step)</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>  y_add <span class="op">=</span> (add_y_bound[<span class="dv">0</span>] <span class="op">+</span> add_y_bound[<span class="dv">1</span>])<span class="op">/</span>((y_max <span class="op">-</span> y_min)<span class="op">/</span>step)</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>  x_max <span class="op">=</span> x_max <span class="op">+</span> add_x_bound[<span class="dv">1</span>]</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>  x_min <span class="op">=</span> x_min <span class="op">-</span> add_x_bound[<span class="dv">0</span>]</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>  y_max <span class="op">=</span> y_max <span class="op">+</span> add_y_bound[<span class="dv">1</span>]</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>  y_min <span class="op">=</span> y_min <span class="op">-</span> add_y_bound[<span class="dv">0</span>]</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>  step <span class="op">=</span> step <span class="op">+</span> math.ceil(np.<span class="bu">max</span>([x_add, y_add]))</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>  x_arr <span class="op">=</span> np.linspace(x_min,x_max,step)</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>  y_arr <span class="op">=</span> np.linspace(y_min,y_max,step)</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>  X,Y <span class="op">=</span> np.meshgrid(x_arr,y_arr)</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>  Z_grid <span class="op">=</span> [[<span class="fl">0.0</span>]<span class="op">*</span>step]<span class="op">*</span>step</span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>  Z_grid <span class="op">=</span> np.array(Z_grid)</span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>  fac_x <span class="op">=</span> <span class="dv">1</span><span class="op">/</span>(x_max<span class="op">-</span>x_min)<span class="op">*</span>step</span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>  fac_y <span class="op">=</span> <span class="dv">1</span><span class="op">/</span>(y_max<span class="op">-</span>y_min)<span class="op">*</span>step</span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> pt <span class="kw">in</span> all_pts:</span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="bu">int</span>((pt[<span class="dv">0</span>] <span class="op">-</span> x_min) <span class="op">*</span> fac_x)</span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> <span class="bu">int</span>((pt[<span class="dv">1</span>] <span class="op">-</span> y_min) <span class="op">*</span> fac_y)</span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x <span class="op">==</span> step:</span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a>      x <span class="op">=</span> x <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> y <span class="op">==</span> step:</span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a>      y <span class="op">=</span> y <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a>    z <span class="op">=</span> pt[<span class="dv">2</span>]</span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a>    curr <span class="op">=</span> Z_grid[x][y]</span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a>    Z_grid[x][y] <span class="op">=</span> f(z, curr)</span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a>  Z_grid <span class="op">=</span> np.transpose(Z_grid)</span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> smooth_fac <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb23-53"><a href="#cb23-53" aria-hidden="true" tabindex="-1"></a>    x_arr <span class="op">=</span> np.linspace(x_min, x_max, num <span class="op">=</span> <span class="bu">int</span>(step <span class="op">*</span> smooth_fac))</span>
<span id="cb23-54"><a href="#cb23-54" aria-hidden="true" tabindex="-1"></a>    y_arr <span class="op">=</span> np.linspace(y_min, y_max, num <span class="op">=</span> <span class="bu">int</span>(step <span class="op">*</span> smooth_fac))</span>
<span id="cb23-55"><a href="#cb23-55" aria-hidden="true" tabindex="-1"></a>    x_new,y_new <span class="op">=</span> np.meshgrid(x_arr,y_arr)</span>
<span id="cb23-56"><a href="#cb23-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-57"><a href="#cb23-57" aria-hidden="true" tabindex="-1"></a>    init_arr <span class="op">=</span> []</span>
<span id="cb23-58"><a href="#cb23-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,step):</span>
<span id="cb23-59"><a href="#cb23-59" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,step):</span>
<span id="cb23-60"><a href="#cb23-60" aria-hidden="true" tabindex="-1"></a>        init_arr.append([<span class="bu">int</span>(i <span class="op">*</span> smooth_fac),</span>
<span id="cb23-61"><a href="#cb23-61" aria-hidden="true" tabindex="-1"></a>                         <span class="bu">int</span>(j <span class="op">*</span> smooth_fac),</span>
<span id="cb23-62"><a href="#cb23-62" aria-hidden="true" tabindex="-1"></a>                         Z_grid[i,j]])</span>
<span id="cb23-63"><a href="#cb23-63" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-64"><a href="#cb23-64" aria-hidden="true" tabindex="-1"></a>    Z_grid <span class="op">=</span> scipy.ndimage.zoom(Z_grid, smooth_fac, order<span class="op">=</span>smooth_kind)</span>
<span id="cb23-65"><a href="#cb23-65" aria-hidden="true" tabindex="-1"></a>    Z_grid <span class="op">=</span> np.clip(Z_grid, a_min <span class="op">=</span> <span class="dv">0</span>, a_max <span class="op">=</span> np.Infinity)</span>
<span id="cb23-66"><a href="#cb23-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-67"><a href="#cb23-67" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> x_new</span>
<span id="cb23-68"><a href="#cb23-68" aria-hidden="true" tabindex="-1"></a>    Y <span class="op">=</span> y_new</span>
<span id="cb23-69"><a href="#cb23-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-70"><a href="#cb23-70" aria-hidden="true" tabindex="-1"></a>  b_i <span class="op">=</span> blur_iter</span>
<span id="cb23-71"><a href="#cb23-71" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> b_i <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb23-72"><a href="#cb23-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-73"><a href="#cb23-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-74"><a href="#cb23-74" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> adj_blur:</span>
<span id="cb23-75"><a href="#cb23-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-76"><a href="#cb23-76" aria-hidden="true" tabindex="-1"></a>      max_lw <span class="op">=</span> <span class="bu">int</span>(smooth_fac) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb23-77"><a href="#cb23-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-78"><a href="#cb23-78" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> truncate <span class="op">&gt;</span> max_lw <span class="op">/</span> (sigma <span class="op">-</span> <span class="fl">0.5</span>):</span>
<span id="cb23-79"><a href="#cb23-79" aria-hidden="true" tabindex="-1"></a>        truncate <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb23-80"><a href="#cb23-80" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;truncate exeeded maximum for resolution, new truncate = &quot;</span>, truncate)</span>
<span id="cb23-81"><a href="#cb23-81" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> sigma <span class="op">&gt;</span> max_lw <span class="op">/</span> (truncate <span class="op">-</span> <span class="fl">0.5</span>):</span>
<span id="cb23-82"><a href="#cb23-82" aria-hidden="true" tabindex="-1"></a>        sigma <span class="op">=</span> (max_lw <span class="op">-</span> <span class="fl">0.5</span>) <span class="op">/</span> truncate</span>
<span id="cb23-83"><a href="#cb23-83" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;sigma exeeded maximum for resolution, new sigma = &quot;</span>, sigma)</span>
<span id="cb23-84"><a href="#cb23-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-85"><a href="#cb23-85" aria-hidden="true" tabindex="-1"></a>      lw <span class="op">=</span> <span class="bu">int</span>(truncate <span class="op">*</span> <span class="bu">float</span>(sigma) <span class="op">+</span> <span class="fl">0.5</span>)</span>
<span id="cb23-86"><a href="#cb23-86" aria-hidden="true" tabindex="-1"></a>      kern <span class="op">=</span> _gaussian_kernel1d(sigma<span class="op">=</span> sigma, order<span class="op">=</span> order, radius<span class="op">=</span> lw)</span>
<span id="cb23-87"><a href="#cb23-87" aria-hidden="true" tabindex="-1"></a>      kernb <span class="op">=</span> np.reshape(kern,(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb23-88"><a href="#cb23-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-89"><a href="#cb23-89" aria-hidden="true" tabindex="-1"></a>      <span class="bu">print</span>(lw)</span>
<span id="cb23-90"><a href="#cb23-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-91"><a href="#cb23-91" aria-hidden="true" tabindex="-1"></a>      keep_vals <span class="op">=</span> []</span>
<span id="cb23-92"><a href="#cb23-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-93"><a href="#cb23-93" aria-hidden="true" tabindex="-1"></a>      Z_rast <span class="op">=</span> np.zeros((step <span class="op">*</span> smooth_fac,step <span class="op">*</span> smooth_fac))</span>
<span id="cb23-94"><a href="#cb23-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-95"><a href="#cb23-95" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,step):</span>
<span id="cb23-96"><a href="#cb23-96" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,step):</span>
<span id="cb23-97"><a href="#cb23-97" aria-hidden="true" tabindex="-1"></a>          keep_vals.append([<span class="bu">int</span>(i <span class="op">*</span> smooth_fac),<span class="bu">int</span>(j <span class="op">*</span> smooth_fac)])</span>
<span id="cb23-98"><a href="#cb23-98" aria-hidden="true" tabindex="-1"></a>      r <span class="op">=</span> <span class="dv">2</span><span class="op">*</span>lw</span>
<span id="cb23-99"><a href="#cb23-99" aria-hidden="true" tabindex="-1"></a>      Z_grid <span class="op">=</span> Z_rast</span>
<span id="cb23-100"><a href="#cb23-100" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb23-101"><a href="#cb23-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-102"><a href="#cb23-102" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb23-103"><a href="#cb23-103" aria-hidden="true" tabindex="-1"></a>      Z_grid <span class="op">=</span> scipy.ndimage.gaussian_filter(Z_grid, sigma<span class="op">=</span>sigma, mode<span class="op">=</span><span class="st">&quot;mirror&quot;</span>) </span>
<span id="cb23-104"><a href="#cb23-104" aria-hidden="true" tabindex="-1"></a>      Z_grid <span class="op">=</span> np.clip(Z_grid, a_min <span class="op">=</span> <span class="dv">0</span>, a_max <span class="op">=</span> np.Infinity)</span>
<span id="cb23-105"><a href="#cb23-105" aria-hidden="true" tabindex="-1"></a>    b_i <span class="op">=</span> b_i <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb23-106"><a href="#cb23-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-107"><a href="#cb23-107" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> X,Y,Z_grid</span></code></pre></div>
</div>
<div class="cell markdown">
<p>Using the make_surf_plot_points function we made above, we can make the 3D mapping of the maximum of the medium alcohol consumption vs the log GDP over time in years.</p>
</div>
<div class="cell code" data-execution_count="92">
<div class="sourceCode" id="cb24"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">## maximum datapoints mapping log2(gdp_pc_2011) and average abv to total alcohol consumption, 2d interpolation and gauss blur smoothing</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">12</span>))</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> fig.gca(projection<span class="op">=</span><span class="st">&#39;3d&#39;</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">&#39;GDP per Capita (log)&#39;</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">&#39;Year&#39;</span>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>ax.set_zlabel(<span class="st">&#39;Medium Consumption per Person&#39;</span>)<span class="op">;</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>ax.title.set_text(<span class="st">&quot;Logrithmically Scalled GDP per Capita vs. Maximum of Medium Consumption per Person over time&quot;</span>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>x_test , y_test, z_max <span class="op">=</span> make_surf_plot_points(all_pts, <span class="dv">16</span>, <span class="dv">25</span>, <span class="kw">lambda</span> x,y : np.<span class="bu">max</span>([x,y]), sigma<span class="op">=</span><span class="dv">5</span>, add_y_bound<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">1</span>), blur_iter <span class="op">=</span> <span class="dv">1</span>, adj_blur <span class="op">=</span> <span class="va">False</span>, smooth_kind<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>ax.plot_surface(x_test, y_test, z_max, cmap<span class="op">=</span><span class="st">&#39;viridis&#39;</span>)</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Top down of the graph</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">14</span>,<span class="dv">12</span>))</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> plt.axes()</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">&#39;GDP per Capita (log)&#39;</span>)</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">&#39;Year&#39;</span>)</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>ax.title.set_text(<span class="st">&quot;Top Down View of Logrithmically Scalled GDP per Capita vs. Maximum of Medium Consumption per Person over time&quot;</span>)</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> ax.pcolormesh(x_test, y_test, z_max, cmap<span class="op">=</span><span class="st">&#39;viridis&#39;</span>, vmin<span class="op">=</span>np.<span class="bu">min</span>(z_max), vmax<span class="op">=</span>np.<span class="bu">max</span>(z_max))</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>fig.colorbar(c, ax<span class="op">=</span>ax)</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img src="vertopal_31107dfa9deb4a6aa742acd4bf7083c0/25fe2006df75958909df660bedf4a0da289d59a6.png" /></p>
</div>
<div class="output display_data">
<p><img src="vertopal_31107dfa9deb4a6aa742acd4bf7083c0/a303d2eafcbc669d0f9a990d124b7c591a98327c.png" /></p>
</div>
</div>
<div class="cell markdown">
<p>By making the average of data points, we can see the trend in alcohol consumption clearer than the maximum alcohol consumption.</p>
</div>
<div class="cell code" data-execution_count="93">
<div class="sourceCode" id="cb25"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">## avg of datapoints mapping log2(gdp_pc_2011) and average abv over time, 2d interpolation and gauss blur smoothing</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">12</span>))</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> fig.gca(projection<span class="op">=</span><span class="st">&#39;3d&#39;</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">&#39;GDP per Capita (log)&#39;</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">&#39;Year&#39;</span>)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>ax.set_zlabel(<span class="st">&#39;Medium Consumption per Person&#39;</span>)<span class="op">;</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>ax.title.set_text(<span class="st">&quot;Average per Sample of Logrithmically Scalled GDP per Capita vs. Maximum of Medium Consumption per Person over time&quot;</span>)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>x_test , y_test, z_tot <span class="op">=</span> make_surf_plot_points(all_pts, <span class="dv">16</span>, <span class="dv">25</span>, <span class="kw">lambda</span> x,y : y <span class="op">+</span> <span class="dv">1</span>, sigma<span class="op">=</span><span class="dv">5</span>, add_y_bound<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">1</span>), blur_iter <span class="op">=</span> <span class="dv">1</span>, adj_blur <span class="op">=</span> <span class="va">False</span>, smooth_kind<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>x_test , y_test, z_test <span class="op">=</span> make_surf_plot_points(all_pts, <span class="dv">16</span>, <span class="dv">25</span>, <span class="kw">lambda</span> x,y : x<span class="op">+</span>y, sigma<span class="op">=</span><span class="dv">5</span>, add_y_bound<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">1</span>), blur_iter <span class="op">=</span> <span class="dv">1</span>, adj_blur <span class="op">=</span> <span class="va">False</span>, smooth_kind<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>z_test <span class="op">=</span> z_test <span class="op">/</span> z_tot</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>ax.plot_surface(x_test, y_test, z_test, cmap<span class="op">=</span><span class="st">&#39;viridis&#39;</span>)</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="co">## top down view of graph</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">12</span>))</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> plt.axes()</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">&#39;GDP per Capita (log)&#39;</span>)</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">&#39;Year&#39;</span>)</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>ax.title.set_text(<span class="st">&quot;Top Down View of APS of Logrithmically Scalled GDP per Capita vs. Maximum of Medium Consumption per Person over time&quot;</span>)</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> ax.pcolormesh(x_test, y_test, z_test, cmap<span class="op">=</span><span class="st">&#39;viridis&#39;</span>, vmin<span class="op">=</span>np.<span class="bu">min</span>(z_test), vmax<span class="op">=</span>np.<span class="bu">max</span>(z_test))</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>fig.colorbar(c, ax<span class="op">=</span>ax)</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img src="vertopal_31107dfa9deb4a6aa742acd4bf7083c0/a4f028f5b1c862bce0e5a7c57b3152d7ed396926.png" /></p>
</div>
<div class="output display_data">
<p><img src="vertopal_31107dfa9deb4a6aa742acd4bf7083c0/a2ca95c4262dcd7135b4d1668f3135a88fbcbf92.png" /></p>
</div>
</div>
<div class="cell markdown">
<p>The top-down representation of this data does a much better job of displaying the correlation. The green represents the highest alcohol consumption while the blue is the lower alcohol consumption. There is a very high concentration of alcohol consumption from the GDP per capita 14 to 16. This indicates a correlation between GDP per capita and alcohol consumption more so than alcohol consumption over time.</p>
</div>
<div class="cell markdown">
<center>
    <h3>Hypothesis testing</h3>
</center>
</div>
<div class="cell markdown">
<p>Before we can analyze the relation between GDP and alcohol consumption, we must first take care of the remaining missing values. To do so we use a K-nearest neighbor approach.</p>
</div>
<div class="cell code" data-execution_count="94">
<div class="sourceCode" id="cb26"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># this dataframe will contain all missing values</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>filled_df <span class="op">=</span> new_comb_df[[<span class="st">&#39;code&#39;</span>,<span class="st">&#39;year&#39;</span>,<span class="st">&#39;gdp_pc_2011_mb&#39;</span>,<span class="st">&#39;population&#39;</span>,<span class="st">&#39;wine_mi&#39;</span>,<span class="st">&#39;beer_mi&#39;</span>,<span class="st">&#39;spirits_mi&#39;</span>,<span class="st">&#39;other_mi&#39;</span>]]</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>filled_df <span class="op">=</span> filled_df.replace(<span class="op">-</span><span class="dv">1</span>,np.nan)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>filled_df</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>consumption_imputer <span class="op">=</span> filled_df</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="co"># when working with a knn model we can&#39;t process string data, so we change coutry codes to numeric values</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>le <span class="op">=</span> preprocessing.LabelEncoder()</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>le.fit(consumption_imputer[<span class="st">&#39;code&#39;</span>])</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>consumption_imputer[<span class="st">&#39;code&#39;</span>] <span class="op">=</span> le.transform(consumption_imputer[<span class="st">&#39;code&#39;</span>])</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>consumption_imputer</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="co"># in order to allow distance functions to work for k nearest neighbors, we change all values to be normalized between 0 and 1</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> preprocessing.MinMaxScaler()</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>consumption_imputer <span class="op">=</span> pd.DataFrame(scaler.fit_transform(consumption_imputer), columns<span class="op">=</span>consumption_imputer.columns)</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>consumption_imputer_na <span class="op">=</span> consumption_imputer</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>consumption_imputer <span class="op">=</span> filled_df.dropna()</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>consumption_imputer</span></code></pre></div>
<div class="output execute_result" data-execution_count="94">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code</th>
      <th>year</th>
      <th>gdp_pc_2011_mb</th>
      <th>population</th>
      <th>wine_mi</th>
      <th>beer_mi</th>
      <th>spirits_mi</th>
      <th>other_mi</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>5</th>
      <td>0</td>
      <td>2005.0</td>
      <td>1187.0</td>
      <td>26335000</td>
      <td>0.0008</td>
      <td>0.009</td>
      <td>0.006</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0</td>
      <td>2006.0</td>
      <td>1257.0</td>
      <td>27154000</td>
      <td>0.0080</td>
      <td>0.011</td>
      <td>0.007</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0</td>
      <td>2007.0</td>
      <td>1447.0</td>
      <td>27387000</td>
      <td>0.0090</td>
      <td>0.007</td>
      <td>0.002</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0</td>
      <td>2008.0</td>
      <td>1464.0</td>
      <td>27706000</td>
      <td>0.0009</td>
      <td>0.009</td>
      <td>0.018</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0</td>
      <td>2009.0</td>
      <td>1669.0</td>
      <td>28484000</td>
      <td>0.0000</td>
      <td>0.010</td>
      <td>0.000</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2817</th>
      <td>166</td>
      <td>2012.0</td>
      <td>1623.0</td>
      <td>12620000</td>
      <td>0.0500</td>
      <td>2.070</td>
      <td>0.470</td>
      <td>1.34</td>
    </tr>
    <tr>
      <th>2818</th>
      <td>166</td>
      <td>2013.0</td>
      <td>1801.0</td>
      <td>13183000</td>
      <td>0.0500</td>
      <td>2.120</td>
      <td>0.470</td>
      <td>1.47</td>
    </tr>
    <tr>
      <th>2819</th>
      <td>166</td>
      <td>2014.0</td>
      <td>1797.0</td>
      <td>13772000</td>
      <td>0.0600</td>
      <td>2.230</td>
      <td>0.360</td>
      <td>1.57</td>
    </tr>
    <tr>
      <th>2820</th>
      <td>166</td>
      <td>2015.0</td>
      <td>1759.0</td>
      <td>14230000</td>
      <td>0.0600</td>
      <td>1.930</td>
      <td>0.360</td>
      <td>1.49</td>
    </tr>
    <tr>
      <th>2821</th>
      <td>166</td>
      <td>2016.0</td>
      <td>1729.0</td>
      <td>14547000</td>
      <td>0.0500</td>
      <td>1.930</td>
      <td>0.350</td>
      <td>1.44</td>
    </tr>
  </tbody>
</table>
<p>2713 rows Ã— 8 columns</p>
</div>
</div>
</div>
<div class="cell code" data-execution_count="95">
<div class="sourceCode" id="cb27"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>fields_to_fill <span class="op">=</span> [<span class="st">&#39;wine_mi&#39;</span>,<span class="st">&#39;beer_mi&#39;</span>,<span class="st">&#39;spirits_mi&#39;</span>,<span class="st">&#39;other_mi&#39;</span>]</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> consumption_imputer[consumption_imputer[fields_to_fill[<span class="dv">0</span>]] <span class="op">&gt;=</span> <span class="dv">0</span>][[<span class="st">&#39;year&#39;</span>,<span class="st">&#39;gdp_pc_2011_mb&#39;</span>,<span class="st">&#39;population&#39;</span>]]</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> consumption_imputer[consumption_imputer[fields_to_fill[<span class="dv">0</span>]] <span class="op">&gt;=</span> <span class="dv">0</span>][fields_to_fill[<span class="dv">0</span>]]</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>x_train, x_test, y_train, y_test <span class="op">=</span> train_test_split(X,Y,train_size<span class="op">=</span><span class="fl">0.7</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="96">
<div class="sourceCode" id="cb28"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>num_k <span class="op">=</span> np.arange(<span class="dv">1</span>,<span class="dv">80</span>,<span class="dv">1</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>accuracy <span class="op">=</span> {} <span class="co">#records the accuracy of each neighbor setting</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> neighbors <span class="kw">in</span> num_k:</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  knn <span class="op">=</span> KNeighborsRegressor(n_neighbors<span class="op">=</span>neighbors)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  model <span class="op">=</span> knn.fit(x_train, y_train)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  y_pred <span class="op">=</span> model.predict(x_test)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  mse <span class="op">=</span> mean_squared_error(y_test,y_pred)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  accuracy[neighbors] <span class="op">=</span> mse</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>plotable_x <span class="op">=</span> np.fromiter(accuracy.keys(), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>plotable_y <span class="op">=</span> np.fromiter(accuracy.values(), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>ax.plot(plotable_x,plotable_y)</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">&#39;k value&#39;</span>)</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">&#39;mean squared error&#39;</span>)</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">&#39;detecting ideal k&#39;</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="96">
<pre><code>Text(0.5, 1.0, &#39;detecting ideal k&#39;)</code></pre>
</div>
<div class="output display_data">
<p><img src="vertopal_31107dfa9deb4a6aa742acd4bf7083c0/3eec25a01dc01dde04533fb8ae1d714c9ce47262.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="97">
<div class="sourceCode" id="cb30"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>consumption_imputer_na <span class="op">=</span> filled_df.fillna(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fillField(field):</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  X <span class="op">=</span> consumption_imputer[consumption_imputer[field] <span class="op">&gt;=</span> <span class="dv">0</span>][[<span class="st">&#39;year&#39;</span>,<span class="st">&#39;gdp_pc_2011_mb&#39;</span>,<span class="st">&#39;population&#39;</span>]]</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  Y <span class="op">=</span> consumption_imputer[consumption_imputer[field] <span class="op">&gt;=</span> <span class="dv">0</span>][field]</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  x_train, x_test, y_train, y_test <span class="op">=</span> train_test_split(X,Y,train_size<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  ideal_k <span class="op">=</span> <span class="bu">min</span>(accuracy, key<span class="op">=</span>accuracy.get) <span class="co"># this k value produced the least amount of error so we will use it!</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  knn <span class="op">=</span> KNeighborsRegressor(n_neighbors<span class="op">=</span>ideal_k)</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  model <span class="op">=</span> knn.fit(x_train, y_train) <span class="co"># we now have the actual interpolation model that we wish to use</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>  cond <span class="op">=</span> (consumption_imputer_na[field] <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>  x_operate <span class="op">=</span> consumption_imputer_na[cond][[<span class="st">&#39;year&#39;</span>,<span class="st">&#39;gdp_pc_2011_mb&#39;</span>,<span class="st">&#39;population&#39;</span>]]</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>  x_operate</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>  mystery_vals <span class="op">=</span> model.predict(x_operate)</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>  index_map <span class="op">=</span> []</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>  j <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> i, x <span class="kw">in</span> x_operate.iterrows():</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>    index_map.append(i)</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>    j <span class="op">=</span> j <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>  consumption_imputer_na.iloc[index_map, consumption_imputer_na.columns.get_loc(field)] <span class="op">=</span> mystery_vals</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>  consumption_imputer_na.iloc[index_map]</span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a><span class="co"># runs through all different fields</span></span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>consumption_imputer_na[<span class="st">&#39;total_consumption&#39;</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> field <span class="kw">in</span> fields_to_fill:</span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>  fillField(field)</span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>  consumption_imputer_na[<span class="st">&#39;total_consumption&#39;</span>] <span class="op">=</span> consumption_imputer_na[<span class="st">&#39;total_consumption&#39;</span>] <span class="op">+</span> consumption_imputer_na[field]</span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>consumption_imputer_na[<span class="st">&#39;code&#39;</span>] <span class="op">=</span> le.inverse_transform(consumption_imputer_na[<span class="st">&#39;code&#39;</span>])</span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a>data_analysis <span class="op">=</span> consumption_imputer_na</span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a>data_analysis</span></code></pre></div>
<div class="output execute_result" data-execution_count="97">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code</th>
      <th>year</th>
      <th>gdp_pc_2011_mb</th>
      <th>population</th>
      <th>wine_mi</th>
      <th>beer_mi</th>
      <th>spirits_mi</th>
      <th>other_mi</th>
      <th>total_consumption</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AFG</td>
      <td>2000.0</td>
      <td>735.000000</td>
      <td>22461000</td>
      <td>1.092857</td>
      <td>1.299286</td>
      <td>2.193571</td>
      <td>0.502857</td>
      <td>5.088571</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AFG</td>
      <td>2001.0</td>
      <td>692.000000</td>
      <td>22507000</td>
      <td>1.082857</td>
      <td>1.395000</td>
      <td>1.585000</td>
      <td>0.502857</td>
      <td>4.565714</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AFG</td>
      <td>2002.0</td>
      <td>1088.000000</td>
      <td>23600000</td>
      <td>0.597714</td>
      <td>2.012857</td>
      <td>1.467143</td>
      <td>0.232000</td>
      <td>4.309714</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AFG</td>
      <td>2003.0</td>
      <td>1112.000000</td>
      <td>25005000</td>
      <td>0.059257</td>
      <td>1.052429</td>
      <td>1.237286</td>
      <td>0.122043</td>
      <td>2.471014</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AFG</td>
      <td>2004.0</td>
      <td>1107.000000</td>
      <td>25698000</td>
      <td>0.069571</td>
      <td>1.387571</td>
      <td>0.988429</td>
      <td>1.686086</td>
      <td>4.131657</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2834</th>
      <td>WORLD</td>
      <td>2012.0</td>
      <td>13815.576851</td>
      <td>6992922992</td>
      <td>0.150000</td>
      <td>1.555714</td>
      <td>3.640000</td>
      <td>0.000071</td>
      <td>5.345786</td>
    </tr>
    <tr>
      <th>2835</th>
      <td>WORLD</td>
      <td>2013.0</td>
      <td>14030.044051</td>
      <td>7072213016</td>
      <td>0.150000</td>
      <td>1.555714</td>
      <td>3.640000</td>
      <td>0.000071</td>
      <td>5.345786</td>
    </tr>
    <tr>
      <th>2836</th>
      <td>WORLD</td>
      <td>2014.0</td>
      <td>14261.271531</td>
      <td>7152269064</td>
      <td>0.150000</td>
      <td>1.555714</td>
      <td>3.640000</td>
      <td>0.000071</td>
      <td>5.345786</td>
    </tr>
    <tr>
      <th>2837</th>
      <td>WORLD</td>
      <td>2015.0</td>
      <td>14493.906019</td>
      <td>7231374064</td>
      <td>0.150000</td>
      <td>1.555714</td>
      <td>3.640000</td>
      <td>0.000071</td>
      <td>5.345786</td>
    </tr>
    <tr>
      <th>2838</th>
      <td>WORLD</td>
      <td>2016.0</td>
      <td>14564.555999</td>
      <td>7311688048</td>
      <td>0.150000</td>
      <td>1.555714</td>
      <td>3.640000</td>
      <td>0.000071</td>
      <td>5.345786</td>
    </tr>
  </tbody>
</table>
<p>2839 rows Ã— 9 columns</p>
</div>
</div>
</div>
<div class="cell markdown">
<p>With our imputed alcohol consumption metrics, we can begin to search for potential correlations.</p>
</div>
<div class="cell code" data-execution_count="98">
<div class="sourceCode" id="cb31"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>fields <span class="op">=</span> [<span class="st">&#39;wine_mi&#39;</span>,<span class="st">&#39;beer_mi&#39;</span>,<span class="st">&#39;spirits_mi&#39;</span>,<span class="st">&#39;other_mi&#39;</span>,<span class="st">&#39;total_consumption&#39;</span>]</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>cond <span class="op">=</span> (data_analysis[<span class="st">&#39;year&#39;</span>] <span class="op">==</span> <span class="dv">2005</span>)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>yearFocus <span class="op">=</span> data_analysis.loc[cond,:]</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>figures <span class="op">=</span> []</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> field <span class="kw">in</span> fields:</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    figures.append((fig,ax))</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, field <span class="kw">in</span> <span class="bu">enumerate</span>(fields):</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>    m, b <span class="op">=</span> np.polyfit(yearFocus[field],yearFocus[<span class="st">&#39;gdp_pc_2011_mb&#39;</span>],<span class="dv">1</span>)</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    figures[i][<span class="dv">1</span>].plot(yearFocus[field],m<span class="op">*</span>yearFocus[field]<span class="op">+</span>b,color<span class="op">=</span><span class="st">&#39;red&#39;</span>)</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>    figures[i][<span class="dv">1</span>].scatter(yearFocus[field],yearFocus[<span class="st">&#39;gdp_pc_2011_mb&#39;</span>])</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>    figures[i][<span class="dv">1</span>].set_xlabel(<span class="ss">f&#39;</span><span class="sc">{</span>field<span class="sc">}</span><span class="ss"> consumption per capita&#39;</span>)</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>    figures[i][<span class="dv">1</span>].set_ylabel(<span class="st">&quot;GDP&quot;</span>)</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>    figures[i][<span class="dv">1</span>].set_title(<span class="ss">f&quot;GDP in relation to </span><span class="sc">{</span>field<span class="sc">}</span><span class="ss"> consumption&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img src="vertopal_31107dfa9deb4a6aa742acd4bf7083c0/ab0ea67874abb4e4f40b098bd639222c6860eb65.png" /></p>
</div>
<div class="output display_data">
<p><img src="vertopal_31107dfa9deb4a6aa742acd4bf7083c0/5f463c57b990522403706c2dc7dce97da6791bf4.png" /></p>
</div>
<div class="output display_data">
<p><img src="vertopal_31107dfa9deb4a6aa742acd4bf7083c0/8d509c788316514292e231f657b70f80431c374f.png" /></p>
</div>
<div class="output display_data">
<p><img src="vertopal_31107dfa9deb4a6aa742acd4bf7083c0/8e842ed340145895dd78f1721fa6ecec9a1c5a02.png" /></p>
</div>
<div class="output display_data">
<p><img src="vertopal_31107dfa9deb4a6aa742acd4bf7083c0/fbc938a3dcbb852857b635369ae24ef926725bbe.png" /></p>
</div>
</div>
<div class="cell markdown">
<p>Before any analysis is performed, it is of utmost importance to note that the presence of a linear interpretation of the relationship does not imply that the data is linear, rather we can use it to decide whether it is possibly linear in the first place. From a blanket look, we see an interesting trend in the data.</p>
<p>While for all but the other categories, the data follows a positive correlation, the highest GDP points seem to have a high error rate when compared to the regression line. This pushes us to analyze the relationship for certain GDP sub-sections.</p>
</div>
<div class="cell code" data-execution_count="99">
<div class="sourceCode" id="cb32"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>mean_gdp <span class="op">=</span> data_analysis[<span class="st">&#39;gdp_pc_2011_mb&#39;</span>].mean()</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>std_gdp <span class="op">=</span> data_analysis[<span class="st">&#39;gdp_pc_2011_mb&#39;</span>].std()</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;The mean of the gdp is </span><span class="sc">{</span>mean_gdp<span class="sc">}</span><span class="ss"> and the std is </span><span class="sc">{</span>std_gdp<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>The mean of the gdp is 15715.212842491961 and the std is 18142.444024374647
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="100">
<div class="sourceCode" id="cb34"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>figures <span class="op">=</span> []</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">4</span>):</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    figures.append((fig,ax))</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    gdp <span class="op">=</span> data_analysis[<span class="st">&#39;gdp_pc_2011_mb&#39;</span>]</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    upper_max <span class="op">=</span> mean_gdp <span class="op">+</span> (std_gdp<span class="op">*</span>i)</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    lower_max <span class="op">=</span> mean_gdp <span class="op">+</span> (std_gdp<span class="op">*</span>(i<span class="op">-</span><span class="dv">1</span>))</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    lower_min <span class="op">=</span> mean_gdp <span class="op">-</span> (std_gdp<span class="op">*</span>i)</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>    upper_min <span class="op">=</span> mean_gdp <span class="op">-</span> (std_gdp<span class="op">*</span>(i<span class="op">-</span><span class="dv">1</span>))</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">!=</span> <span class="dv">3</span>:</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>        payFocus1 <span class="op">=</span> data_analysis[(data_analysis[<span class="st">&#39;gdp_pc_2011_mb&#39;</span>] <span class="op">&gt;=</span> lower_max) <span class="op">&amp;</span> (data_analysis[<span class="st">&#39;gdp_pc_2011_mb&#39;</span>] <span class="op">&lt;=</span> upper_max)]</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>        payFocus2 <span class="op">=</span> data_analysis[(data_analysis[<span class="st">&#39;gdp_pc_2011_mb&#39;</span>] <span class="op">&gt;=</span> lower_min) <span class="op">&amp;</span> (data_analysis[<span class="st">&#39;gdp_pc_2011_mb&#39;</span>] <span class="op">&lt;=</span> upper_min)]</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>        payFocus1 <span class="op">=</span> data_analysis[(data_analysis[<span class="st">&#39;gdp_pc_2011_mb&#39;</span>] <span class="op">&gt;=</span> lower_max)]</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>        payFocus2 <span class="op">=</span> data_analysis[(data_analysis[<span class="st">&#39;gdp_pc_2011_mb&#39;</span>] <span class="op">&lt;=</span> upper_min)]</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>    payFocus <span class="op">=</span> pd.concat([payFocus1,payFocus2])</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>    m, b <span class="op">=</span> np.polyfit(payFocus[<span class="st">&#39;total_consumption&#39;</span>],payFocus[<span class="st">&#39;gdp_pc_2011_mb&#39;</span>],<span class="dv">1</span>)</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>    figures[i<span class="op">-</span><span class="dv">1</span>][<span class="dv">1</span>].plot(payFocus[<span class="st">&#39;total_consumption&#39;</span>],m<span class="op">*</span>payFocus[<span class="st">&#39;total_consumption&#39;</span>]<span class="op">+</span>b,color<span class="op">=</span><span class="st">&#39;red&#39;</span>)</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>    figures[i<span class="op">-</span><span class="dv">1</span>][<span class="dv">1</span>].scatter(payFocus[<span class="st">&#39;total_consumption&#39;</span>],payFocus[<span class="st">&#39;gdp_pc_2011_mb&#39;</span>])</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>    figures[i<span class="op">-</span><span class="dv">1</span>][<span class="dv">1</span>].set_xlabel(<span class="ss">f&#39;Total alch. consumption&#39;</span>)</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>    figures[i<span class="op">-</span><span class="dv">1</span>][<span class="dv">1</span>].set_ylabel(<span class="st">&quot;GDP&quot;</span>)</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>    figures[i<span class="op">-</span><span class="dv">1</span>][<span class="dv">1</span>].set_title(<span class="ss">f&quot;GDP in relation to alc consumption within </span><span class="sc">{i}</span><span class="ss"> stds.&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img src="vertopal_31107dfa9deb4a6aa742acd4bf7083c0/8841cafe1ed8f5946eae45dc7ceff9e58432a15a.png" /></p>
</div>
<div class="output display_data">
<p><img src="vertopal_31107dfa9deb4a6aa742acd4bf7083c0/1236efb4899f460956ff64a2807abfab20a16769.png" /></p>
</div>
<div class="output display_data">
<p><img src="vertopal_31107dfa9deb4a6aa742acd4bf7083c0/0d56c6f046b8cb1835659d78785eac5f1ebdd75f.png" /></p>
</div>
</div>
<div class="cell markdown">
<p>It would appear that our intuition may be right. For average GDP it would appear that alcohol consumption has a positive correlation, but for wealthy and poor zones, the less alcohol, the higher the GDP. What this appears to tell us is that at the extremes of both poverty and wealth, the relationship between GDP and alcohol consumption becomes stronger.</p>
</div>
<div class="cell markdown">
<center>
    <h3>Conclusion</h3>
</center>
<p>Based on our evaluation and analysis, average GDP and alcohol consumption has a positive correlation. This indicates that for the majority of countries, the alcohol consumption of their citizens does not impede their productivity and is beneficial to a country. We also found that there is a positive correlation between beer, wine, and spirit consumption and GDP while there is a negative correlation between other alcoholic drink consumption and GDP.</p>
<p>Another interesting observation that we found was the GDP vs alcohol consumption in standard deviations. What we found was that countries with GDP in one standard deviation had a positive correlation with alcohol consumption. However, countries with GDP of two and three standard deviations had a negative correlation with alcohol consumption. This means that countries that are either very wealthy or very poor may drink less alcohol on average. For poor countries, it makes sense as their citizens may not have the finances to buy alcohol but for wealthy countries this is surprising. This could indicate that wealthy countries don't drink as much alcohol thus making their citizens more productive.</p>
<p>If anything this tutorial should show you that alcohol consumption in a country is not immediately a bad thing.</p>
<p>The CSV and DTA files that are used in this tutorial are available on <a href = "https://github.com/evanamay/CMSC320-Final-Project">GitHub</a></p>
<hr>
</div>
</body>
</html>
